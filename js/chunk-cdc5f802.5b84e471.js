(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cdc5f802"],{"271ae":function(t,e,a){},"2ddc":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice",style:t.warpStyle},[e("div",{staticClass:"multi-choice-input"},["daterange"==t.dateType?e("div",[e("el-date-picker",{attrs:{type:t.dateType,"picker-options":t.pickerOptions,"range-separator":"-",align:"center","unlink-panels":"",clearable:!1,"start-placeholder":t.$t("device.driverinitialdate"),"end-placeholder":t.$t("device.drivereffectivedate")},on:{change:t.onChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1):t._e(),"date"==t.dateType?e("div",[e("el-date-picker",{attrs:{type:"date","picker-options":t.datePickerOptions},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1):t._e(),"datetimerange"==t.dateType?e("div",{staticClass:"datetimerange"},[e("el-date-picker",{attrs:{type:t.dateType,"range-separator":"-","picker-options":t.pickerOptionsTime,align:"center","unlink-panels":"",clearable:!1,"start-placeholder":t.$t("device.driverinitialdate"),"end-placeholder":t.$t("device.drivereffectivedate"),"default-time":["00:00:00","23:59:59"]},on:{change:t.onChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1):t._e(),"month"==t.dateType?e("div",[e("el-date-picker",{attrs:{type:"month"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1):t._e()])])},n=[],r=(a("99af"),a("5101")),o=a("5867"),s={name:"SelectDate",props:{value:{type:Array|Date,default:function(){return[]}},dateType:{type:String,default:"daterange"},label:{type:String,default:function(){return this.$t("common.selectTime")}}},computed:{isDaterange:function(){return"daterange"==this.dateType},warpStyle:function(){var t=200;switch(this.dateType){case"date":t=120;break;case"daterange":t=230;break;case"datetimerange":t=310;break}return{width:"".concat(t,"px")}}},mixins:[o["a"]],data:function(){var t=864e5;return{dateRange:[],date:new Date,month:new Date,pickerOptions:{shortcuts:[{text:this.$t("reportForm.toDay"),onClick:function(t){var e=new Date;t.$emit("pick",[e,e])}},{text:this.$t("reportForm.yesterDay"),onClick:function(e){var a=new Date;a.setTime(a.getTime()-t),e.$emit("pick",[a,a])}},{text:this.$t("missing.theWeek"),onClick:function(e){var a=new Date,i=new Date,n=a.getDay();a.setTime(a.getTime()-t*(n-1)),i.setTime(a.getTime()+6*t),e.$emit("pick",[a,i])}},{text:this.$t("missing.lastWeek"),onClick:function(e){var a=new Date,i=new Date,n=a.getDay(),r=a.getTime()-t*(n-1);a.setTime(r-7*t),i.setTime(r-t),e.$emit("pick",[a,i])}},{text:this.$t("missing.thisMonth"),onClick:function(t){var e=new Date,a=e.getFullYear(),i=e.getMonth()+1,n=new Date("".concat(a,"-").concat(i,"-01")),r=new Date("".concat(a,"-").concat(i,"-01 00:00:00"));r.setMonth(r.getMonth()+1),r=new Date(r.getTime()-1e3),t.$emit("pick",[n,r])}},{text:this.$t("missing.lastMonth"),onClick:function(t){var e=new Date;e.setMonth(e.getMonth()-1);var a=e.getFullYear(),i=e.getMonth()+1,n=new Date(new Date(a,i,1)-1).getDate(),r=new Date("".concat(a,"-").concat(i,"-01")),o=new Date("".concat(a,"-").concat(i,"-").concat(n));t.$emit("pick",[r,o])}}]},pickerOptionsTime:{shortcuts:[{text:this.$t("reportForm.toDay"),onClick:function(t){var e=new Date(r["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),a=new Date(r["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59");t.$emit("pick",[e,a])}},{text:this.$t("reportForm.yesterDay"),onClick:function(e){var a=new Date;a.setTime(a.getTime()-t),e.$emit("pick",[new Date(r["a"].format(a,"yyyy-MM-dd")+" 00:00:00"),new Date(r["a"].format(a,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.theWeek"),onClick:function(e){var a=new Date,i=new Date,n=a.getDay();a.setTime(a.getTime()-t*(n-1)),i.setTime(a.getTime()+6*t),e.$emit("pick",[new Date(r["a"].format(a,"yyyy-MM-dd")+" 00:00:00"),new Date(r["a"].format(i,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.lastWeek"),onClick:function(e){var a=new Date,i=new Date,n=a.getDay(),o=a.getTime()-t*(n-1);a.setTime(o-7*t),i.setTime(o-t),e.$emit("pick",[new Date(r["a"].format(a,"yyyy-MM-dd")+" 00:00:00"),new Date(r["a"].format(i,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.thisMonth"),onClick:function(t){var e=new Date,a=e.getFullYear(),i=e.getMonth()+1,n=new Date("".concat(a,"-").concat(i,"-01")),o=new Date("".concat(a,"-").concat(i,"-01 00:00:00"));o.setMonth(o.getMonth()+1),o=new Date(o.getTime()-1e3),t.$emit("pick",[new Date(r["a"].format(n,"yyyy-MM-dd")+" 00:00:00"),new Date(r["a"].format(o,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.lastMonth"),onClick:function(t){var e=new Date;e.setMonth(e.getMonth()-1);var a=e.getFullYear(),i=e.getMonth()+1,n=new Date(new Date(a,i,1)-1).getDate(),o=new Date("".concat(a,"-").concat(i,"-01")),s=new Date("".concat(a,"-").concat(i,"-").concat(n));t.$emit("pick",[new Date(r["a"].format(o,"yyyy-MM-dd")+" 00:00:00"),new Date(r["a"].format(s,"yyyy-MM-dd")+" 23:59:59")])}}]}}},watch:{dateRange:function(t){null==t?this.$emit("input",[]):this.$emit("input",t)},value:function(t){this.dateRange=t},date:function(t){this.$emit("input",t)},month:function(t){this.$emit("input",t)}},methods:{onChange:function(t){this.$emit("input",t)}},mounted:function(){"date"==this.dateType?this.date=this.value:"month"==this.dateType?this.month=this.value:this.dateRange=this.value}},c=s,l=(a("e716"),a("2877")),d=Object(l["a"])(c,i,n,!1,null,"5dbb8594",null);e["a"]=d.exports},"4c3c":function(t,e,a){"use strict";a("4e82");e["a"]={data:function(){return{sortConfig:{sortMethod:function(t){var e=t.data,a=t.sortList,i=a[0],n=i.property,r=i.order,o=[];return o="desc"===r?e.sort((function(t,e){var a=t[n],i=e[n];if(isNaN(a)&&!isNaN(Date.parse(a))&&isNaN(i)&&!isNaN(Date.parse(i)))return Date.parse(i)-Date.parse(a);if(a=parseFloat(a),i=parseFloat(i),isNaN(a)||isNaN(i)){var r=e[n]+"";return r.localeCompare(t[n])}return i-a})):"asc"===r?e.sort((function(t,e){var a=t[n],i=e[n];if(isNaN(a)&&!isNaN(Date.parse(a))&&isNaN(i)&&!isNaN(Date.parse(i)))return Date.parse(a)-Date.parse(i);if(a=parseFloat(t[n]),i=parseFloat(e[n]),isNaN(a)||isNaN(i)){var r=t[n]+"";return r.localeCompare(e[n])}return a-i})):e.sort(),o}}}}}},cdec:function(t,e,a){"use strict";a.r(e);var i=a("ade3"),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full oil-month-summary"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("SelectDate",{attrs:{dateType:"month"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{type:"primary",loading:t.exportLoading1},on:{click:t.exportData}},[t._v(t._s(t.$t("common.export")))])],1)]),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"39px"}},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{"cell-style":t.cellStyle,"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"",size:"mini","show-overflow":"","highlight-hover-row":"",height:"auto",data:t.totalList},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index"),fixed:"left"}}),e("vxe-table-column",{attrs:Object(i["a"])({field:"devicename",sortable:"",width:"120",title:t.$t("alarm.devName"),fixed:"left"},"sortable","")}),e("vxe-table-column",{attrs:Object(i["a"])({field:"deviceid",sortable:"",width:"120",title:t.$t("alarm.devNum")},"sortable","")}),e("vxe-table-column",{attrs:{field:"creater",title:t.$t("reportForm.creater"),width:"90",sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[e("div",{staticClass:"parents-wrapper"},t._l(t.parentsList,(function(a){return e("div",{key:a.username},[t._v(t._s(a.username)+"("+t._s(a.usertypeStr)+")")])})),0),e("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.queryParents(a.row.creater)}},slot:"reference"},[t._v(t._s(a.row.creater))])],1)]}}])}),e("vxe-table-column",{attrs:{field:"groupname",title:t.$t("reportForm.groupName"),width:"90",sortable:""}}),e("vxe-table-column",{attrs:{field:"usageRate",title:t.$t("reportForm.usageRate"),width:"90",sortable:""}}),e("vxe-table-column",{attrs:{field:"totaldistance",formatter:t.numberToFixed2,sortable:"",width:"145",title:t.$t("reportForm.totalMileage")}}),t._l(t.dayList,(function(a,i){return[e("vxe-table-column",{key:i,attrs:{title:a.label+"(km)",width:"80",formatter:t.numberToFixed2,field:"day"+(i+1),sortable:""}})]}))],2)],1)])])},r=[],o=(a("14d9"),a("a9e3"),a("b680"),a("d3b7"),a("159b"),a("5101")),s=a("e561"),c=a("d462"),l=a("6e52"),d=a("1c31"),u=a("4c3c"),m=a("a05b"),h=a("0c87"),p=a("c276"),f={name:"MileageMonth",data:function(){return{show:!1,loading:!1,exportLoading1:!1,month:new Date,totalList:[],dayList:[]}},mixins:[u["a"],m["a"],h["a"]],components:{MultiChoiceVehicle:s["a"],SelectDate:c["a"]},watch:{month:function(){this.loading||this.handleQuery()}},methods:{numberToFixed2:p["nb"],cellStyle:function(t){t.row,t.rowIndex;var e=t.column,a={};return"devicename"===e.property&&"deviceid"===e.property&&"creater"===e.property&&"groupname"===e.property||(a.textAlign="right"),a},onSelectDevice:function(t){this.deviceids=t},handleQuery:function(){var t=this,e=this.deviceids;if(0!=e.length){this.loading=!0,this.dayList=this.getDayList();var a=this.dayList.length,n=this.month.getFullYear(),r=this.month.getMonth()+1,s={year:n,month:r,offset:o["a"].getOffset(),deviceids:e},c={totaldistance:0,devicename:"",deviceid:"",creater:"",groupname:"",usageRate:this.$t("reportForm.total")};Object(d["S"])(s).then((function(e){var n=e.devices;t.loading=!1,n.forEach((function(t,e){t.index=e+1;var i=t.deviceid,n=l["a"].deviceInfos[i],r=n.devicename,o=n.creater,s=n.groupname;t.devicename=r,t.creater=o,t.groupname=s;for(var d=t.records,u=0,m=0,h=0;h<a;h++){var p=d[h];if(p){var f=p.statisticsday.split("-")[2],y=p.totaldistance;u+=y,y>0&&m++;var g="day"+String(parseInt(f)),v=y/1e3;void 0===c[g]&&(c[g]=0),c[g]=c[g]+v,t[g]=y/1e3}}for(var D=0;D<a;D++){f="day"+(D+1);t[f]||(t[f]=0,void 0===c[f]&&(c[f]=0))}t.usageRate=Number((m/a*100).toFixed(2))+"%",t.totaldistance=u/1e3,c.totaldistance+=u/1e3})),n.length>0&&(n.push(Object(i["a"])({totaldistance:"",devicename:"",deviceid:"",creater:"",groupname:"",usageRate:""},"totaldistance","")),c.totaldistance,n.push(c)),t.totalList=n})).catch((function(e){console.log(e),t.loading=!1}))}else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},exportData:function(){for(var t=o["a"].format(this.month,"yyyy_MM"),e=this.dayList.length,a=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.usageRate"),this.$t("reportForm.totalMileage")]],i=t.split("_")[0],n=t.split("_")[1],r=0;r<e;r++)a[0].push(i+"/"+n+"/"+(r+1)+"(km)");if(0!=this.totalList.length){this.totalList.forEach((function(t,i){var n=[];n.push(i+1),n.push(t.devicename),n.push(t.deviceid),n.push(t.creater),n.push(t.groupname),n.push(t.usageRate),n.push(Object(p["nb"])(t.totaldistance));for(var r=0;r<e;r++){var o="day"+(r+1);void 0!=t[o]?n.push(Object(p["nb"])(t[o])):n.push("")}a.push(n)}));var s={title:this.$t("reportForm.mileageMonth")+"_"+t,data:a};this.exportLoading1=!0,new ExcelCls(s).exportExcel(this)}},getTheMonthDays:function(t){var e=t.getFullYear(),a=t.getMonth()+1;return new Date(new Date(e,a,1)-1).getDate()},getDayList:function(){for(var t=[],e=this.getTheMonthDays(this.month),a=1;a<=e;a++)t.push({label:String(a),value:"day".concat(a)});return t}},mounted:function(){var t=this;this.$nextTick((function(){t.dayList=t.getDayList()}))}},y=f,g=(a("ce71"),a("2877")),v=Object(g["a"])(y,n,r,!1,null,null,null),D=v.exports;e["default"]=D},ce71:function(t,e,a){"use strict";a("f6bd")},d462:function(t,e,a){"use strict";var i=a("2ddc");e["a"]=i["a"]},e561:function(t,e,a){"use strict";var i=a("ea22");e["a"]=i["a"]},e716:function(t,e,a){"use strict";a("271ae")},f6bd:function(t,e,a){}}]);