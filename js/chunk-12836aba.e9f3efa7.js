(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12836aba"],{"50c0":function(e,t,i){},ad2d:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-device full"},[t("div",{staticClass:"edit-device-left"},[t("div",{staticClass:"edit-device-inner full"},[t("div",{staticClass:"edit-device-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("common.selectDevice"))}}),t("span",{domProps:{textContent:e._s(e.$t("missing.viewEditDevice"))}})]),t("div",{staticClass:"edit-device-inner-content"},[t("div",{staticClass:"edit-device-inner-content-search"},[t("div",[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("reportForm.pleaseEnterSearchContent")},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),t("div",{on:{click:e.refreshZtree}},[t("i",{staticClass:"el-icon-refresh"})])]),t("div",{staticClass:"edit-device-inner-content-ztree"},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("ul",{staticClass:"ztree",attrs:{id:e.ztreeId}})])],1)])])]),t("div",{staticClass:"edit-device-right"},[t("div",{staticClass:"edit-device-inner full"},[t("div",{staticClass:"edit-device-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("bgManage.editDevice"))}}),t("span",{domProps:{textContent:e._s(e.$t("missing.editDeviceHere"))}})]),t("div",{staticClass:"edit-device-inner-content"},[t("div",{staticClass:"full",staticStyle:{overflow:"hidden"}},[t("div",{staticClass:"device"},[t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("alarm.devNum")}},[t("el-input",{attrs:{disabled:""},model:{value:e.baseInfo.deviceid,callback:function(t){e.$set(e.baseInfo,"deviceid",t)},expression:"baseInfo.deviceid"}})],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("reportForm.deviceType")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",disabled:"","filter-method":e.deviceTypeFilterMethod},model:{value:e.baseInfo.devicetype,callback:function(t){e.$set(e.baseInfo,"devicetype",t)},expression:"baseInfo.devicetype"}},e._l(e.deviceTypes,(function(e,i){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("alarm.devName")}},[t("el-input",{attrs:{placeholder:e.$t("tips.inputDevicename")},model:{value:e.baseInfo.devicename,callback:function(t){e.$set(e.baseInfo,"devicename",t)},expression:"baseInfo.devicename"}})],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("bgManage.simNum")}},[t("el-input",{attrs:{disabled:e.isDisableSim,placeholder:e.$t("tips.inputPhoneNumber")},model:{value:e.baseInfo.simnum,callback:function(t){e.$set(e.baseInfo,"simnum",t)},expression:"baseInfo.simnum"}})],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("reportForm.remarks")}},[e.userType<2?t("el-input",{model:{value:e.baseInfo.remark,callback:function(t){e.$set(e.baseInfo,"remark",t)},expression:"baseInfo.remark"}}):t("el-input",{model:{value:e.baseInfo.remark2,callback:function(t){e.$set(e.baseInfo,"remark2",t)},expression:"baseInfo.remark2"}})],1)],1),t("div",{staticStyle:{"text-align":"center","padding-top":"30px"}},[t("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary",loading:e.loading,disabled:void 0==e.baseInfo.deviceid},on:{click:e.handleClickEdit}},[e._v(e._s(e.$t("common.edit")))])],1)])])])])])])},s=[],a=i("5530"),r=(i("99af"),i("caad"),i("c975"),i("14d9"),i("b0c0"),i("a9e3"),i("d3b7"),i("2532"),i("159b"),i("c276")),c=i("cd6d"),o=i.n(c),l=i("6e52"),d=i("c7bc"),u=i("0139"),h=i("2f62"),v=i("7cf8"),f=i("e285"),p=i("0d33"),b=i("7fa8"),m={name:"editDevice",data:function(){return{loading:!1,baseInfo:{},searchText:"",deviceTypes:[]}},computed:Object(a["a"])(Object(a["a"])({},Object(h["b"])(["isZh","userName","userType","userLevelList","isQueryInitData","userType","deviceTypeList","permissionList"])),{},{ztreeId:function(){return"ztreeEl_".concat(this._uid)},isDisableSim:function(){return!this.permissionList.includes("monitor-editdevice-editsim")}}),watch:{searchText:function(e){this.searchZtree(this,e)},isQueryInitData:function(e){e&&this.init()}},components:{DropdownZtreeUser:d["a"],LabelWrap:u["a"]},methods:Object(a["a"])(Object(a["a"])({},Object(h["c"])(["setIsReloadRootuser"])),{},{deviceTypeFilterMethod:r["h"],searchZtree:Object(r["e"])((function(e,t){if(e.ztreeIns.destroy(),0==t.length)e.ztreeIns=$.fn.zTree.init($("#".concat(e.ztreeId)),e.setting,e.treeNodes);else{var i=e.variableDeepSearch([e.treeNodes],t);e.ztreeIns=$.fn.zTree.init($("#".concat(e.ztreeId)),e.setting,i)}}),300),onTreeCheck:function(e,t,i){var n=this;i.deviceid&&Object(v["H"])(i.deviceid).then((function(e){var t=e.device;t&&(n.baseInfo=t,n.oldcreater=t.creater,n.oldgroupid=t.groupid)}))},handleClickEdit:function(){var e=this,t=this.baseInfo;this.loading=!0,t.needalarm=-1,Object(f["N"])(t).then((function(i){var n=i.status;if(e.loading=!1,0==n){var s=l["a"].deviceInfos[t.deviceid],a=s.devicename;Object.assign(s,t),a!=t.devicename&&e.updateNode(s),e.$XModal.message({message:e.$t("tips.editSucc"),status:"success",zIndex:9999})}else 91==n?e.$XModal.message({message:e.$t("tips.noPermission"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.editFail"),status:"error",zIndex:9999})}))},updateNode:function(e){var t=e.deviceid,i=l["a"].lastPositions[t],n=this.$dateformat.getCurrentUTC(),s=Object(r["hb"])(this.ztreeIns.getNodes(),t);s.name=Object(r["eb"])(e,!!i&&i.online>0,i,n),this.ztreeIns.updateNode(s)},selectDeviceNode:function(e){var t=Object(r["hb"])(this.ztreeIns.getNodes(),e);this.ztreeIns.selectNode(t)},refreshZtree:function(){this.ztreeIns.destroy(),this.initZtree()},initZtree:function(){var e=this.castUsersTreeToDevicesTree(l["a"].rootuser);this.treeNodes=e,this.ztreeIns=$.fn.zTree.init($("#".concat(this.ztreeId)),this.setting,e),this.selectedRoot()},variableDeepSearch:function(e,t){t=t.toLowerCase();for(var i=[],n=this,s=0;s<e.length;s++){var a=null,r=e[s];if(null!=r){var c=!1;if((-1!=r.name.toLowerCase().indexOf(t)||r.username&&-1!=r.username.toLowerCase().indexOf(t)||r.deviceid&&-1!=r.deviceid.toLowerCase().indexOf(t)||r.loginname&&-1!=r.loginname.toLowerCase().indexOf(t)||r.remark&&-1!=r.remark.toLowerCase().indexOf(t)||r.remark2&&-1!=r.remark2.toLowerCase().indexOf(t)||r.simiccid&&-1!=r.simiccid.toLowerCase().indexOf(t)||r.simnum&&-1!=r.simnum.toLowerCase().indexOf(t))&&(a=o()(r),a.open=!1,c=!0),0==c&&r.children&&r.children.length>0){var l=n.variableDeepSearch(r.children,t);l&&l.length>0&&(a=o()(r),a.children=l,a.open=!0,c=!0)}1==c&&i.push(a)}}return i},selectedRoot:function(){var e=this.ztreeIns.getNodes()[0];e&&this.ztreeIns.checkNode(e,!0)},castUsersTreeToDevicesTree:function(e){var t=this,i={name:"ç©º",children:[],open:!0,icon:p,nodeType:l["a"].NodeType_User,nocheck:!0};if(e){var n=e.username,s=e.subusers;i.name=n,i.username=n,i.id=n;var a=Object(r["o"])(e.groups),c=Object(r["E"])(a,e.groups,s),o=null;null!=a&&(o=e.groups[a]);var d=this.getDeviceListGroups(e.groups,n,c);if(null!=n&&null!=s&&s.length>0){var u=this.doCastUsersTreeToDevicesTree(s);i.children=d.concat(u)}else i.children=d;i.children.forEach((function(e){e.nocheck=!t.isCheck})),Object(r["Gb"])(i.children);var h=0,v=0;if(0==c&&o&&o.devices.length){var f=this.$dateformat.getCurrentUTC(),b=l["a"].lastPositions;o.devices.forEach((function(e){if(e){var t=Object(r["F"])(b[e.deviceid],f);t&&v++;var n=Object(r["t"])(e,t,f);i.children.push(n)}})),Object(r["Fb"])(i.children)}if(i.children)for(var m=0;m<i.children.length;++m){var g=i.children[m];void 0!=g.totalCount&&(h+=g.totalCount,v+=g.onlineCount)}i.totalCount=h,i.name+="("+v+"/"+h+")"}return i},doCastUsersTreeToDevicesTree:function(e){var t=this,i=[];if(null!=e&&e.length>0)for(var n,s,a,c,o,d,u,h,v,f,b,m,g,C=function(){if(n=e[T],s=n.username,a=n.subusers,c=n.showname,o=0,d={name:c||s,username:s,showname:c,icon:p,nodeType:l["a"].NodeType_User,nocheck:!0},u=Object(r["o"])(n.groups),h=Object(r["E"])(u,i.groups,a),v=null,null!=u&&(v=n.groups[u]),f=t.getDeviceListGroups(n.groups,s,h),f.forEach((function(e){o+=e.onlineCount})),null!=s&&null!=a&&a.length>0?(b=t.doCastUsersTreeToDevicesTree(a),b.forEach((function(e){o+=e.onlineCount})),b=f.concat(b),d.children=b):d.children=f,Object(r["Gb"])(d.children),d.children.forEach((function(e){e.nocheck=!t.isCheck})),0==h&&v&&v.devices.length){var C=t.$dateformat.getCurrentUTC(),I=l["a"].lastPositions;v.devices.forEach((function(e){if(e){var t=Object(r["F"])(I[e.deviceid],C);t&&o++;var i=Object(r["t"])(e,t,C);d.children.push(i)}})),Object(r["Fb"])(d.children)}if(m=0,d.children)for(g=0;g<d.children.length;++g){var k=d.children[g];void 0!=k.totalCount?m+=k.totalCount:m++}d.totalCount=m,d.onlineCount=o,d.name+="("+o+"/"+m+")",i.push(d)},T=0;T<e.length;++T)C();return i},getDeviceListGroups:function(e,t,i){var n=[],s=l["a"].lastPositions,a=this.$t("common.defaultGroup");if(e)for(var c=this.$dateformat.getCurrentUTC(),o=0;o<e.length;++o){var d=e[o],u=void 0===d.shared?0:d.shared,h=d.groupid>0;if(i||h){var v=h?d.groupname:a,f=__pinyin.get(v),p=f.l,m=f.p,g={groupid:d.groupid,name:v,label:v,groupname:v,icon:b,username:t,nodeType:l["a"].NodeType_Group,l:p,p:m,status:""},C=0;d.devices&&(g.totalCount=d.devices.length,g.children=[],d.devices.forEach((function(e){if(e){var t=Object(r["F"])(s[e.deviceid],c);t&&C++;var i=Object(r["t"])(e,t,c);g.children.push(i)}})),Object(r["Fb"])(g.children)),g.onlineCount=C,g.name+="("+C+"/"+d.devices.length+")",g.label+="(".concat(g.children.length,")"),h?1!==u&&n.push(g):g.children.length&&n.push(g)}}return n},getUserOptions:function(e,t){var i=[],n=!1;return this.userLevelList.forEach((function(s){var a=s.name,r=s.type;0==n&&t&&e==r&&(i.push({label:a,value:Number(r)}),n=!0),r>e&&r<=11&&i.push({label:a,value:Number(r)})})),i},init:function(){var e=this;this.$nextTick((function(){e.deviceTypes=e.deviceTypeList,e.initZtree()}))},zTreeOnClick:function(e,t,i){$("#"+i.tId+"_switch").click(),this.ztreeIns.checkNode(i),this.onTreeCheck(e,t,i)}}),created:function(){this.treeId=null,this.oilCreater=null,this.groupname="",this.groupid="",this.setting={view:{dblClickExpand:!1},check:{enable:!0,chkStyle:"radio",radioType:"all"},callback:{onCheck:this.onTreeCheck,onClick:this.zTreeOnClick}}},mounted:function(){this.isQueryInitData&&this.init()}},g=m,C=(i("b09d"),i("2877")),T=Object(C["a"])(g,n,s,!1,null,null,null),I=T.exports;t["default"]=I},b09d:function(e,t,i){"use strict";i("50c0")}}]);