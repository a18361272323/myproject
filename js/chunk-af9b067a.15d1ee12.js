(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-af9b067a"],{"26c6":function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"multi-choice single-choice-vehicle",style:{width:e.width}},[e.showLabel?t("div",{staticClass:"multi-choice-label"},[e._v(" "+e._s(e.$t("common.selectDevice"))+" ")]):e._e(),t("div",{staticClass:"multi-choice-input"},[t("ZtreeDeviceDropdown",{attrs:{placeholder:e.placeholder,disableShare:e.disableShare,isQueryInitData:e.isQueryInitData},model:{value:e.deviceid,callback:function(t){e.deviceid=t},expression:"deviceid"}})],1)])},s=[],r=i("5530"),a=i("2f62"),c=i("2df7"),o={props:{value:{type:String,default:""},width:{type:String,default:"230px"},showLabel:{type:Boolean,default:!1},disableShare:{type:Boolean,default:!1},placeholder:{type:String,default:""}},name:"SingleChoiceVehicle",data:function(){return{deviceid:""}},watch:{value:function(e){e&&(this.deviceid=e)},deviceid:function(e){this.$emit("input",e)}},computed:Object(r["a"])({},Object(a["b"])(["isQueryInitData"])),components:{ZtreeDeviceDropdown:c["a"]},methods:{},mounted:function(){this.value&&(this.deviceid=this.value)}},l=o,d=(i("facb"),i("2877")),h=Object(d["a"])(l,n,s,!1,null,null,null);t["a"]=h.exports},"2df7":function(e,t,i){"use strict";i("498a");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ztree-device"},[t("el-popover",{attrs:{placement:"bottom",width:"320",trigger:"manual","append-to-body":!0,"popper-options":{boundariesElement:"body",gpuAcceleration:!0,positionFixed:!0,preventOverflow:!0}},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.handleClickOutside,expression:"handleClickOutside"}],staticClass:"ztree-drapdown",staticStyle:{height:"360px",width:"100%",overflow:"hidden"}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("ul",{staticClass:"ztree",attrs:{id:e.ztreeId}})])],1),t("el-input",{attrs:{slot:"reference",placeholder:e.placeholder,"prefix-icon":"el-icon-search"},on:{input:e.onChange},nativeOn:{click:function(t){return e.handleClickInput.apply(null,arguments)}},slot:"reference",model:{value:e.textVal,callback:function(t){e.textVal="string"===typeof t?t.trim():t},expression:"textVal"}},[t("span",{staticClass:"el-input__suffix-inner",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:e.clearText},slot:"suffix"},[t("i",{staticClass:"el-input__icon el-icon-circle-close"})])])],1)],1)},s=[],r=i("5530"),a=(i("99af"),i("4de4"),i("c975"),i("d81d"),i("14d9"),i("b0c0"),i("d3b7"),i("159b"),i("4795"),i("cd6d")),c=i.n(a),o=i("6e52"),l=i("c276"),d=i("9169"),h=i("2f62"),u=i("0d33"),v=i("7fa8"),f={name:"ZtreeDeviceDropdown",props:{value:{type:String,default:""},isCheck:{type:Boolean,default:!1},isClickAll:{type:Boolean,default:!1},disableShare:{type:Boolean,default:!1},selectDeviceIds:{type:Array,default:function(){return[]}},isQueryInitData:{type:Boolean,default:!1},placeholder:{type:String,default:""}},directives:{Clickoutside:d["a"]},computed:Object(r["a"])(Object(r["a"])({},Object(h["b"])(["isZh"])),{},{ztreeId:function(){return"ztreeEl_".concat(this._uid)}}),data:function(){return{textVal:"",show:!1}},watch:{textVal:function(e){this.isClickAll?this.$emit("input",e):0==this.isCheck?e||this.$emit("input",""):e||this.$emit("onTreeCheck",[])},isQueryInitData:function(e){var t=this;this.$nextTick((function(){t.init()}))}},created:function(){this.ztreeIns=null,this.setting={view:{addDiyDom:this.addDiyDom,dblClickExpand:!1},check:{enable:!0,chkStyle:this.isCheck?"checkbox":"radio",radioType:"all"},callback:{onCheck:this.onTreeCheck,onClick:this.zTreeOnClick}}},mounted:function(){var e=this;this.$nextTick((function(){e.init()}))},destroyed:function(){this.ztreeIns&&this.ztreeIns.destroy()},methods:{init:function(){var e=this;if(this.isQueryInitData&&null==this.ztreeIns)if(this.initZtree(),0==this.isCheck){if(this.value){var t=o["a"].deviceInfos[this.value].devicename;this.textVal=t;var i=Object(l["hb"])(this.ztreeIns.getNodes(),this.value);i?this.ztreeIns.checkNode(i):console.log("ZtreeDeviceDropdown 没找到node this.textVal = ",this.textVal)}}else if(this.selectDeviceIds.length>0){var n=this.ztreeIns.getNodes();this.selectDeviceIds.forEach((function(t){var i=Object(l["hb"])(n,t);i&&e.ztreeIns.checkNode(i,!0)})),this.isZh?this.textVal="已选中".concat(this.selectDeviceIds.length,"个单位"):this.textVal="".concat(this.selectDeviceIds.length," is selected"),this.$emit("onTreeCheck",this.selectDeviceIds)}},handleClickInput:function(){var e=this;if(this.show=!0,0==this.isCheck){var t=o["a"].deviceInfos[this.value],i=t?t.devicename:null;if(i&&(this.textVal=i,this.ztreeIns&&this.ztreeIns.getNodes)){var n=Object(l["hb"])(this.ztreeIns.getNodes(),this.value);n&&setTimeout((function(){e.ztreeIns.selectNode(n)}),30)}}},clearText:function(){this.textVal="",this.ztreeIns&&(this.ztreeIns.destroy(),this.ztreeIns=null),this.treeNodeChildren.length&&(this.treeNodeChildren[0].open=!0),this.ztreeIns=$.fn.zTree.init($("#".concat(this.ztreeId)),this.setting,this.treeNodeChildren),this.isCheck?this.$emit("onTreeCheck",[]):this.$emit("input","")},handleClickOutside:function(){this.show=!1},searchDevice:Object(l["e"])((function(e,t){if(0==e.show&&(e.show=!0),e.ztreeIns.destroy(),0==t.length)e.treeNodeChildren.length&&(e.treeNodeChildren[0].open=!0),e.ztreeIns=$.fn.zTree.init($("#".concat(e.ztreeId)),e.setting,e.treeNodeChildren);else{t=t.trim();var i=e.variableDeepSearch(e.treeNodeChildren,t,0);e.ztreeIns=$.fn.zTree.init($("#".concat(e.ztreeId)),e.setting,i)}}),300),variableDeepSearch:function(e,t,i){t=t.toLowerCase();for(var n=[],s=this,r=0;r<e.length;r++){var a=null,o=e[r];if(null!=o){var l=!1;if((-1!=o.name.toLowerCase().indexOf(t)||o.showname&&-1!=o.showname.toLowerCase().indexOf(t)||o.deviceid&&-1!=o.deviceid.toLowerCase().indexOf(t)||o.simiccid&&-1!=o.simiccid.toLowerCase().indexOf(t)||o.loginname&&-1!=o.loginname.toLowerCase().indexOf(t)||o.remark&&-1!=o.remark.toLowerCase().indexOf(t)||o.remark2&&-1!=o.remark2.toLowerCase().indexOf(t)||o.simiccid&&-1!=o.simiccid.toLowerCase().indexOf(t)||o.simnum&&-1!=o.simnum.toLowerCase().indexOf(t))&&(a=o,a.open=!1,l=!0),0==l&&o.children&&o.children.length>0){var d=s.variableDeepSearch(o.children,t,i);d&&d.length>0&&(a=c()(o),a.children=d,a.open=!0,l=!0)}if(1==l&&(i++,n.push(a),i>1e3))break}}return n},onChange:function(e){this.searchDevice(this,e)},getCheckedDeviceIds:function(){var e=this.ztreeIns.getCheckedNodes(),t=[];return e.forEach((function(e){var i=e.deviceid;void 0!=i&&t.push(i)})),t},initZtree:function(){var e=this.castUsersTreeToDevicesTree(o["a"].rootuser);this.isCheck?this.treeNodeChildren=[e]:e.children&&e.children.length?this.treeNodeChildren=e.children:this.treeNodeChildren=[],this.ztreeIns=$.fn.zTree.init($("#".concat(this.ztreeId)),this.setting,this.treeNodeChildren)},addDiyDom:function(e,t){var i=$("#"+t.tId+"_check"),n=$("#"+t.tId+"_ico");n.remove(),i.before(n)},selectNode:function(e){var t=this;if(0==this.isCheck){var i=o["a"].deviceInfos[e],n=i?i.devicename:null;if(n&&(this.textVal=n,this.$emit("input",e),this.ztreeIns&&this.ztreeIns.getNodes)){var s=Object(l["hb"])(this.ztreeIns.getNodes(),this.value);s&&setTimeout((function(){t.ztreeIns.selectNode(s)}),30)}}},onTreeCheck:function(e,t,i){var n=this.ztreeIns.getCheckedNodes();if(this.isClickAll){var s=i.nodeType;if(s==o["a"].NodeType_User)this.textVal=i.username,this.$emit("input",this.textVal);else if(s==o["a"].NodeType_Group)this.textVal=i.groupname,this.$emit("input",this.textVal);else{var r=i.deviceid,a=o["a"].deviceInfos[r].devicename;this.textVal=a,this.$emit("input",r)}}else if(0==n.length)this.textVal="";else if(this.isCheck){var c=n.filter((function(e){return void 0==e.children})).map((function(e){return e.deviceid}));this.isZh?this.textVal="已选中".concat(c.length,"个单位"):this.textVal="".concat(c.length," is selected"),this.$emit("onTreeCheck",c)}else if(i.deviceid){var l=i.deviceid,d=o["a"].deviceInfos[l].devicename;this.textVal=d,this.$emit("input",l),this.show=!1}},zTreeOnClick:function(e,t,i){$("#"+i.tId+"_switch").click(),i.nodeType!=o["a"].NodeType_Device_Normal&&i.nodeType!=o["a"].NodeType_Device_Video||(this.ztreeIns.checkNode(i,!i.checked,!0),this.onTreeCheck(e,t,i))},castUsersTreeToDevicesTree:function(e){var t=this,i={name:"空",children:[],open:!0,icon:u,nodeType:o["a"].NodeType_User,nocheck:!this.isCheck};if(e){var n=e.username,s=e.subusers;i.name=n,i.username=n,i.id=n;var r=Object(l["o"])(e.groups),a=Object(l["E"])(r,e.groups,s),c=null;null!=r&&(c=e.groups[r]);var d=this.getDeviceListGroups(e.groups,n,a);if(null!=n&&null!=s&&s.length>0){var h=this.doCastUsersTreeToDevicesTree(s);i.children=d.concat(h)}else i.children=d;i.children.forEach((function(e){e.nocheck=!t.isCheck})),Object(l["Gb"])(i.children);var v=0,f=0;if(0==a&&c&&c.devices.length){var p=this.$dateformat.getCurrentUTC(),m=o["a"].lastPositions;c.devices.forEach((function(e){if(e){v++;var t=Object(l["F"])(m[e.deviceid],p);t&&f++;var n=Object(l["t"])(e,t,p);i.children.push(n)}})),Object(l["Fb"])(i.children)}if(i.children)for(var b=0;b<i.children.length;++b){var g=i.children[b];void 0!=g.totalCount&&(v+=g.totalCount,f+=g.onlineCount)}i.totalCount=v,i.name+="("+f+"/"+v+")"}return i},doCastUsersTreeToDevicesTree:function(e){var t=this,i=[];if(null!=e&&e.length>0)for(var n,s,r,a,c,d,h,v,f,p,m,b,g,C=function(){if(n=e[x],s=n.username,r=n.subusers,a=n.showname,c=0,d={name:a||s,username:s,showname:a,icon:u,nodeType:o["a"].NodeType_User},h=Object(l["o"])(n.groups),v=Object(l["E"])(h,i.groups,r),f=null,null!=h&&(f=n.groups[h]),p=t.getDeviceListGroups(n.groups,s,v),p.forEach((function(e){c+=e.onlineCount})),null!=s&&null!=r&&r.length>0?(m=t.doCastUsersTreeToDevicesTree(r),m.forEach((function(e){c+=e.onlineCount})),m=p.concat(m),d.children=m):d.children=p,Object(l["Gb"])(d.children),d.children.forEach((function(e){e.nocheck=!t.isCheck})),0==v&&f&&f.devices.length){var C=t.$dateformat.getCurrentUTC(),k=o["a"].lastPositions;f.devices.forEach((function(e){if(e){var t=Object(l["F"])(k[e.deviceid],C);t&&c++;var i=Object(l["t"])(e,t,C);d.children.push(i)}})),Object(l["Fb"])(d.children)}if(b=0,d.children)for(g=0;g<d.children.length;++g){var y=d.children[g];void 0!=y.totalCount?b+=y.totalCount:b++}d.totalCount=b,d.onlineCount=c,d.name+="("+c+"/"+b+")",i.push(d)},x=0;x<e.length;++x)C();return i},getDeviceListGroups:function(e,t,i){var n=[],s=o["a"].lastPositions,r=this.$t("common.defaultGroup");if(e)for(var a=this.$dateformat.getCurrentUTC(),c=0;c<e.length;++c){var d=e[c],h=(void 0===d.shared||d.shared,d.groupid>0);if(i||h){var u=h?d.groupname:r,f=__pinyin.get(u),p=f.l,m=f.p,b={groupid:d.groupid,name:u,label:u,groupname:u,icon:v,username:t,nodeType:o["a"].NodeType_Group,l:p,p:m,status:""},g=0;if(d.devices&&(b.totalCount=d.devices.length,b.children=[],d.devices.forEach((function(e){if(e){var t=Object(l["F"])(s[e.deviceid],a);t&&g++;var i=Object(l["t"])(e,t,a);b.children.push(i)}})),Object(l["Fb"])(b.children)),b.onlineCount=g,b.name+="("+g+"/"+d.devices.length+")",b.label+="(".concat(b.children.length,")"),h){if(this.disableShare&&1==d.shared)continue;n.push(b)}else b.children.length&&n.push(b)}}return n}}},p=f,m=(i("eca4"),i("2877")),b=Object(m["a"])(p,n,s,!1,null,"98b76e1e",null),g=b.exports;t["a"]=g},"76d3":function(e,t,i){},b174:function(e,t,i){},ccf3:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"report-form full"},[t("div",{staticClass:"report-form-inner"},[t("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[t("div",{staticClass:"f_left"},[t("SingleChoiceVehicle",{attrs:{placeholder:this.$t("tips.selectSingleDevice"),width:"230px"},model:{value:e.deviceid,callback:function(t){e.deviceid=t},expression:"deviceid"}})],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleQuery}},[e._v(e._s(e.$t("common.query")))])],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{type:"primary",loading:e.exportLoading1},on:{click:e.exportData}},[e._v(e._s(e.$t("common.export")))])],1)]),t("div",{staticClass:"report-form-inner-content",staticStyle:{top:"39px"}},[t("vxe-table",{attrs:{"menu-config":e.tableMenu,border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:e.totalList},on:{"menu-click":e.handleClickTableMenu}},[t("vxe-table-column",{attrs:{type:"seq",width:"60",title:e.$t("reportForm.index")}}),t("vxe-table-column",{attrs:{field:"devicename",title:e.$t("alarm.devName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"deviceid",title:e.$t("alarm.devNum"),sortable:""}}),t("vxe-table-column",{attrs:{field:"creater",title:e.$t("reportForm.creater"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(i){return t("div",{key:i.username},[e._v(e._s(i.username)+"("+e._s(i.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(i.row.creater)}},slot:"reference"},[e._v(e._s(i.row.creater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"groupname",title:e.$t("reportForm.groupName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"stralarm",title:e.$t("alarm.alarmType"),sortable:""}}),t("vxe-table-column",{attrs:{field:"time",title:e.$t("reportForm.time"),sortable:""}}),t("vxe-table-column",{attrs:{field:"notifyresult",title:e.$t("reportForm.result"),sortable:""}})],1)],1)])])},s=[],r=i("5530"),a=(i("14d9"),i("d3b7"),i("159b"),i("2f62")),c=i("d03a"),o=i("1c31"),l=i("6e52"),d=i("5101"),h=i("a05b"),u=i("0c87"),v={name:"wechatAlarm",data:function(){return{deviceid:"",loading:!1,exportLoading1:!1,totalList:[]}},mixins:[h["a"],u["a"]],components:{SingleChoiceVehicle:c["a"]},computed:Object(r["a"])({},Object(a["b"])(["isZh","singleDeviceid"])),watch:{deviceid:function(e){this.setSingleDeviceid(e)}},methods:Object(r["a"])(Object(r["a"])({},Object(a["c"])(["setSingleDeviceid"])),{},{handleQuery:function(){var e=this,t=this.deviceid;t?Object(o["x"])(t).then((function(i){var n=i.records,s=[];if(n){var r=l["a"].deviceInfos[t];n.forEach((function(e){e.devicename=r.devicename,e.creater=l["a"].getShowName(r.creater),e.groupname=r.groupname,e.time=d["a"].longToLocalDateTimeStr(e.lastalarmtime)})),s=n}e.totalList=s})):this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999})},exportData:function(){if(this.totalList.length){var e=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("alarm.alarmType"),this.$t("reportForm.time"),this.$t("reportForm.result")]],t="";this.totalList.forEach((function(i,n){var s=[];""==t&&(t=i.deviceid),s.push(n+1),s.push(i.devicename),s.push(i.deviceid),s.push(i.creater),s.push(i.groupname),s.push(i.stralarm),s.push(i.time),s.push(i.notifyresult),e.push(s)}));var i={title:this.$t("reportForm.wechatAlarm")+" - "+t,data:e};this.exportLoading1=!0,new ExcelCls(i).exportExcel(this)}}}),mounted:function(){this.singleDeviceid&&(this.deviceid=this.singleDeviceid)}},f=v,p=(i("dc60"),i("2877")),m=Object(p["a"])(f,n,s,!1,null,null,null),b=m.exports;t["default"]=b},d03a:function(e,t,i){"use strict";var n=i("26c6");t["a"]=n["a"]},dc60:function(e,t,i){"use strict";i("76d3")},ec11:function(e,t,i){},eca4:function(e,t,i){"use strict";i("b174")},facb:function(e,t,i){"use strict";i("ec11")}}]);