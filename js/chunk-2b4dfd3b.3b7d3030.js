(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b4dfd3b"],{"2df7":function(e,t,i){"use strict";i("498a");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ztree-device"},[t("el-popover",{attrs:{placement:"bottom",width:"320",trigger:"manual","append-to-body":!0,"popper-options":{boundariesElement:"body",gpuAcceleration:!0,positionFixed:!0,preventOverflow:!0}},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.handleClickOutside,expression:"handleClickOutside"}],staticClass:"ztree-drapdown",staticStyle:{height:"360px",width:"100%",overflow:"hidden"}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("ul",{staticClass:"ztree",attrs:{id:e.ztreeId}})])],1),t("el-input",{attrs:{slot:"reference",placeholder:e.placeholder,"prefix-icon":"el-icon-search"},on:{input:e.onChange},nativeOn:{click:function(t){return e.handleClickInput.apply(null,arguments)}},slot:"reference",model:{value:e.textVal,callback:function(t){e.textVal="string"===typeof t?t.trim():t},expression:"textVal"}},[t("span",{staticClass:"el-input__suffix-inner",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:e.clearText},slot:"suffix"},[t("i",{staticClass:"el-input__icon el-icon-circle-close"})])])],1)],1)},s=[],c=i("5530"),r=(i("99af"),i("4de4"),i("c975"),i("d81d"),i("14d9"),i("b0c0"),i("d3b7"),i("159b"),i("4795"),i("cd6d")),o=i.n(r),a=i("6e52"),l=i("c276"),h=i("9169"),d=i("2f62"),u=i("0d33"),f=i("7fa8"),v={name:"ZtreeDeviceDropdown",props:{value:{type:String,default:""},isCheck:{type:Boolean,default:!1},isClickAll:{type:Boolean,default:!1},disableShare:{type:Boolean,default:!1},selectDeviceIds:{type:Array,default:function(){return[]}},isQueryInitData:{type:Boolean,default:!1},placeholder:{type:String,default:""}},directives:{Clickoutside:h["a"]},computed:Object(c["a"])(Object(c["a"])({},Object(d["b"])(["isZh"])),{},{ztreeId:function(){return"ztreeEl_".concat(this._uid)}}),data:function(){return{textVal:"",show:!1}},watch:{textVal:function(e){this.isClickAll?this.$emit("input",e):0==this.isCheck?e||this.$emit("input",""):e||this.$emit("onTreeCheck",[])},isQueryInitData:function(e){var t=this;this.$nextTick((function(){t.init()}))}},created:function(){this.ztreeIns=null,this.setting={view:{addDiyDom:this.addDiyDom,dblClickExpand:!1},check:{enable:!0,chkStyle:this.isCheck?"checkbox":"radio",radioType:"all"},callback:{onCheck:this.onTreeCheck,onClick:this.zTreeOnClick}}},mounted:function(){var e=this;this.$nextTick((function(){e.init()}))},destroyed:function(){this.ztreeIns&&this.ztreeIns.destroy()},methods:{init:function(){var e=this;if(this.isQueryInitData&&null==this.ztreeIns)if(this.initZtree(),0==this.isCheck){if(this.value){var t=a["a"].deviceInfos[this.value].devicename;this.textVal=t;var i=Object(l["gb"])(this.ztreeIns.getNodes(),this.value);i?this.ztreeIns.checkNode(i):console.log("ZtreeDeviceDropdown 没找到node this.textVal = ",this.textVal)}}else if(this.selectDeviceIds.length>0){var n=this.ztreeIns.getNodes();this.selectDeviceIds.forEach((function(t){var i=Object(l["gb"])(n,t);i&&e.ztreeIns.checkNode(i,!0)})),this.isZh?this.textVal="已选中".concat(this.selectDeviceIds.length,"个单位"):this.textVal="".concat(this.selectDeviceIds.length," is selected"),this.$emit("onTreeCheck",this.selectDeviceIds)}},handleClickInput:function(){var e=this;if(this.show=!0,0==this.isCheck){var t=a["a"].deviceInfos[this.value],i=t?t.devicename:null;if(i&&(this.textVal=i,this.ztreeIns&&this.ztreeIns.getNodes)){var n=Object(l["gb"])(this.ztreeIns.getNodes(),this.value);n&&setTimeout((function(){e.ztreeIns.selectNode(n)}),30)}}},clearText:function(){this.textVal="",this.ztreeIns&&(this.ztreeIns.destroy(),this.ztreeIns=null),this.treeNodeChildren.length&&(this.treeNodeChildren[0].open=!0),this.ztreeIns=$.fn.zTree.init($("#".concat(this.ztreeId)),this.setting,this.treeNodeChildren),this.isCheck?this.$emit("onTreeCheck",[]):this.$emit("input","")},handleClickOutside:function(){this.show=!1},searchDevice:Object(l["e"])((function(e,t){if(0==e.show&&(e.show=!0),e.ztreeIns.destroy(),0==t.length)e.treeNodeChildren.length&&(e.treeNodeChildren[0].open=!0),e.ztreeIns=$.fn.zTree.init($("#".concat(e.ztreeId)),e.setting,e.treeNodeChildren);else{t=t.trim();var i=e.variableDeepSearch(e.treeNodeChildren,t,0);e.ztreeIns=$.fn.zTree.init($("#".concat(e.ztreeId)),e.setting,i)}}),300),variableDeepSearch:function(e,t,i){t=t.toLowerCase();for(var n=[],s=this,c=0;c<e.length;c++){var r=null,a=e[c];if(null!=a){var l=!1;if((-1!=a.name.toLowerCase().indexOf(t)||a.showname&&-1!=a.showname.toLowerCase().indexOf(t)||a.deviceid&&-1!=a.deviceid.toLowerCase().indexOf(t)||a.simiccid&&-1!=a.simiccid.toLowerCase().indexOf(t)||a.loginname&&-1!=a.loginname.toLowerCase().indexOf(t)||a.remark&&-1!=a.remark.toLowerCase().indexOf(t)||a.remark2&&-1!=a.remark2.toLowerCase().indexOf(t)||a.simiccid&&-1!=a.simiccid.toLowerCase().indexOf(t)||a.simnum&&-1!=a.simnum.toLowerCase().indexOf(t))&&(r=a,r.open=!1,l=!0),0==l&&a.children&&a.children.length>0){var h=s.variableDeepSearch(a.children,t,i);h&&h.length>0&&(r=o()(a),r.children=h,r.open=!0,l=!0)}if(1==l&&(i++,n.push(r),i>1e3))break}}return n},onChange:function(e){this.searchDevice(this,e)},getCheckedDeviceIds:function(){var e=this.ztreeIns.getCheckedNodes(),t=[];return e.forEach((function(e){var i=e.deviceid;void 0!=i&&t.push(i)})),t},initZtree:function(){var e=this.castUsersTreeToDevicesTree(a["a"].rootuser);this.isCheck?this.treeNodeChildren=[e]:e.children&&e.children.length?this.treeNodeChildren=e.children:this.treeNodeChildren=[],this.ztreeIns=$.fn.zTree.init($("#".concat(this.ztreeId)),this.setting,this.treeNodeChildren)},addDiyDom:function(e,t){var i=$("#"+t.tId+"_check"),n=$("#"+t.tId+"_ico");n.remove(),i.before(n)},selectNode:function(e){var t=this;if(0==this.isCheck){var i=a["a"].deviceInfos[e],n=i?i.devicename:null;if(n&&(this.textVal=n,this.$emit("input",e),this.ztreeIns&&this.ztreeIns.getNodes)){var s=Object(l["gb"])(this.ztreeIns.getNodes(),this.value);s&&setTimeout((function(){t.ztreeIns.selectNode(s)}),30)}}},onTreeCheck:function(e,t,i){var n=this.ztreeIns.getCheckedNodes();if(this.isClickAll){var s=i.nodeType;if(s==a["a"].NodeType_User)this.textVal=i.username,this.$emit("input",this.textVal);else if(s==a["a"].NodeType_Group)this.textVal=i.groupname,this.$emit("input",this.textVal);else{var c=i.deviceid,r=a["a"].deviceInfos[c].devicename;this.textVal=r,this.$emit("input",c)}}else if(0==n.length)this.textVal="";else if(this.isCheck){var o=n.filter((function(e){return void 0==e.children})).map((function(e){return e.deviceid}));this.isZh?this.textVal="已选中".concat(o.length,"个单位"):this.textVal="".concat(o.length," is selected"),this.$emit("onTreeCheck",o)}else if(i.deviceid){var l=i.deviceid,h=a["a"].deviceInfos[l].devicename;this.textVal=h,this.$emit("input",l),this.show=!1}},zTreeOnClick:function(e,t,i){$("#"+i.tId+"_switch").click(),i.nodeType!=a["a"].NodeType_Device_Normal&&i.nodeType!=a["a"].NodeType_Device_Video||(this.ztreeIns.checkNode(i,!i.checked,!0),this.onTreeCheck(e,t,i))},castUsersTreeToDevicesTree:function(e){var t=this,i={name:"空",children:[],open:!0,icon:u,nodeType:a["a"].NodeType_User,nocheck:!this.isCheck};if(e){var n=e.username,s=e.subusers;i.name=n,i.username=n,i.id=n;var c=Object(l["n"])(e.groups),r=Object(l["D"])(c,e.groups,s),o=null;null!=c&&(o=e.groups[c]);var h=this.getDeviceListGroups(e.groups,n,r);if(null!=n&&null!=s&&s.length>0){var d=this.doCastUsersTreeToDevicesTree(s);i.children=h.concat(d)}else i.children=h;i.children.forEach((function(e){e.nocheck=!t.isCheck})),Object(l["Fb"])(i.children);var f=0,v=0;if(0==r&&o&&o.devices.length){var p=this.$dateformat.getCurrentUTC(),C=a["a"].lastPositions;o.devices.forEach((function(e){if(e){f++;var t=Object(l["E"])(C[e.deviceid],p);t&&v++;var n=Object(l["s"])(e,t,p);i.children.push(n)}})),Object(l["Eb"])(i.children)}if(i.children)for(var m=0;m<i.children.length;++m){var b=i.children[m];void 0!=b.totalCount&&(f+=b.totalCount,v+=b.onlineCount)}i.totalCount=f,i.name+="("+v+"/"+f+")"}return i},doCastUsersTreeToDevicesTree:function(e){var t=this,i=[];if(null!=e&&e.length>0)for(var n,s,c,r,o,h,d,f,v,p,C,m,b,g=function(){if(n=e[k],s=n.username,c=n.subusers,r=n.showname,o=0,h={name:r||s,username:s,showname:r,icon:u,nodeType:a["a"].NodeType_User},d=Object(l["n"])(n.groups),f=Object(l["D"])(d,i.groups,c),v=null,null!=d&&(v=n.groups[d]),p=t.getDeviceListGroups(n.groups,s,f),p.forEach((function(e){o+=e.onlineCount})),null!=s&&null!=c&&c.length>0?(C=t.doCastUsersTreeToDevicesTree(c),C.forEach((function(e){o+=e.onlineCount})),C=p.concat(C),h.children=C):h.children=p,Object(l["Fb"])(h.children),h.children.forEach((function(e){e.nocheck=!t.isCheck})),0==f&&v&&v.devices.length){var g=t.$dateformat.getCurrentUTC(),I=a["a"].lastPositions;v.devices.forEach((function(e){if(e){var t=Object(l["E"])(I[e.deviceid],g);t&&o++;var i=Object(l["s"])(e,t,g);h.children.push(i)}})),Object(l["Eb"])(h.children)}if(m=0,h.children)for(b=0;b<h.children.length;++b){var T=h.children[b];void 0!=T.totalCount?m+=T.totalCount:m++}h.totalCount=m,h.onlineCount=o,h.name+="("+o+"/"+m+")",i.push(h)},k=0;k<e.length;++k)g();return i},getDeviceListGroups:function(e,t,i){var n=[],s=a["a"].lastPositions,c=this.$t("common.defaultGroup");if(e)for(var r=this.$dateformat.getCurrentUTC(),o=0;o<e.length;++o){var h=e[o],d=(void 0===h.shared||h.shared,h.groupid>0);if(i||d){var u=d?h.groupname:c,v=__pinyin.get(u),p=v.l,C=v.p,m={groupid:h.groupid,name:u,label:u,groupname:u,icon:f,username:t,nodeType:a["a"].NodeType_Group,l:p,p:C,status:""},b=0;if(h.devices&&(m.totalCount=h.devices.length,m.children=[],h.devices.forEach((function(e){if(e){var t=Object(l["E"])(s[e.deviceid],r);t&&b++;var i=Object(l["s"])(e,t,r);m.children.push(i)}})),Object(l["Eb"])(m.children)),m.onlineCount=b,m.name+="("+b+"/"+h.devices.length+")",m.label+="(".concat(m.children.length,")"),d){if(this.disableShare&&1==h.shared)continue;n.push(m)}else m.children.length&&n.push(m)}}return n}}},p=v,C=(i("eca4"),i("2877")),m=Object(C["a"])(p,n,s,!1,null,"98b76e1e",null),b=m.exports;t["a"]=b},"3b13":function(e,t,i){},7031:function(e,t,i){"use strict";i("3b13")},b174:function(e,t,i){},ea22:function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"multi-choice multi-choice-vehicle"},[t("div",{staticClass:"multi-choice-input"},[t("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:e.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:e.isQueryInitData,selectDeviceIds:e.multipleDeviceids},on:{onTreeCheck:e.onTreeCheck}})],1)])},s=[],c=i("5530"),r=(i("4795"),i("2f62")),o=i("2df7"),a={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(c["a"])({},Object(r["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:o["a"]},methods:Object(c["a"])(Object(c["a"])({},Object(r["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(e){this.$emit("onSelectDevice",e),this.setMultipleDeviceids(e)},clearText:function(){var e=this;setTimeout((function(){e.$refs.ztreeDevice.clearText()}),300)}})},l=a,h=(i("7031"),i("2877")),d=Object(h["a"])(l,n,s,!1,null,null,null);t["a"]=d.exports},eca4:function(e,t,i){"use strict";i("b174")}}]);