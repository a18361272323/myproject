(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36820c2c"],{"074c":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full"},[e("div",{staticClass:"report-form-inner"},[e("el-scrollbar",{staticStyle:{width:"100%"}},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"45px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left",staticStyle:{width:"180px"}},[e("LabelWrap",{attrs:{label:t.$t("reportForm.selectIo")}},[e("el-select",{staticStyle:{width:"130px"},attrs:{multiple:"","collapse-tags":""},model:{value:t.ioindexs,callback:function(e){t.ioindexs=e},expression:"ioindexs"}},t._l(t.ioLists,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("div",{staticClass:"f_left"},[e("SelectDate",{model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",{staticClass:"f_left"},[e("QuickTimeRange",{model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{type:"primary",loading:t.exportLoading1},on:{click:t.exportData}},[t._v(t._s(t.$t("common.export")))])],1)])]),e("div",{staticClass:"report-form-inner-tabs"},[e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:t.$t("reportForm.ioStatistics")+"(".concat(t.totalList.length,")"),name:"tabTotal"}}),e("el-tab-pane",{attrs:{label:"",name:"details"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:"details"==t.activeName,expression:"activeName=='details'"}],staticClass:"tableTitle"},[e("b",{domProps:{textContent:t._s(t.tableTitle)}}),t._v("("+t._s(t.detailsList.length)+") ")])],1),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"80px"}},[e("div",{style:t.statisticsStyle},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.totalList},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{title:t.$t("reportForm.action"),width:"70"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleClickRow(i.row)}}},[t._v(t._s(t.$t("reportForm.details")))])]}}])}),e("vxe-table-column",{attrs:{field:"devicename",title:t.$t("alarm.devName"),width:"140",sortable:""}}),e("vxe-table-column",{attrs:{field:"deviceid",title:t.$t("alarm.devNum"),width:"140",sortable:""}}),e("vxe-table-column",{attrs:{field:"creater",title:t.$t("reportForm.creater"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[e("div",{staticClass:"parents-wrapper"},t._l(t.parentsList,(function(i){return e("div",{key:i.username},[t._v(t._s(i.username)+"("+t._s(i.usertypeStr)+")")])})),0),e("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.queryParents(i.row.creater)}},slot:"reference"},[t._v(t._s(i.row.creater))])],1)]}}])}),e("vxe-table-column",{attrs:{field:"groupname",title:t.$t("reportForm.groupName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"ioIndex",title:t.$t("reportForm.ioIndex"),sortable:""}}),e("vxe-table-column",{attrs:{field:"ioName",title:t.$t("reportForm.ioName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"openCount",title:t.$t("reportForm.openCount"),sortable:""}}),e("vxe-table-column",{attrs:{field:"openDuration",align:"right",formatter:t.numberToFixed2,title:t.$t("reportForm.openDuration"),sortable:""}}),e("vxe-table-column",{attrs:{field:"totalrunningfuel",align:"right",formatter:t.numberToFixed2,width:"120",title:t.$t("reportForm.oilConsumption"),sortable:""}}),e("vxe-table-column",{attrs:{field:"totalotherfuel",align:"right",formatter:t.numberToFixed2,width:"120",title:t.$t("reportForm.totalnotrunningad"),sortable:""}})],1)],1),e("div",{staticClass:"io-content-details",style:t.detailsStyle},[e("div",[e("vxe-table",{ref:"xTable",staticClass:"mytable-scrollbar",attrs:{border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-current-row":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.detailsList,"row-config":{isCurrent:!0,isHover:!0}},on:{"cell-click":t.cellClickEvent}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{field:"ioindex",title:t.$t("reportForm.ioIndex"),width:"60",sortable:""}}),e("vxe-table-column",{attrs:{field:"ioname",title:t.$t("reportForm.ioName"),width:"120",sortable:""}}),e("vxe-table-column",{attrs:{field:"begintimeStr",title:t.$t("reportForm.startTime"),width:"158",sortable:""}}),e("vxe-table-column",{attrs:{field:"endtimeStr",title:t.$t("reportForm.endTime"),width:"158",sortable:""}}),e("vxe-table-column",{attrs:{field:"sdistance",align:"right",formatter:t.numberToFixed2,title:t.$t("reportForm.startDistance"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"edistance",align:"right",formatter:t.numberToFixed2,title:t.$t("reportForm.endDistance"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"duration",align:"right",formatter:t.numberToFixed2,title:t.$t("reportForm.duration"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"totalrunningfuel",align:"right",formatter:t.numberToFixed2,width:"120",title:t.$t("reportForm.oilConsumption"),sortable:""}}),e("vxe-table-column",{attrs:{field:"totalotherfuel",align:"right",formatter:t.numberToFixed2,width:"120",title:t.$t("reportForm.totalnotrunningad"),sortable:""}}),e("vxe-table-column",{attrs:{field:"startaddress",title:t.$t("reportForm.startAddress"),width:"240",sortable:""}}),e("vxe-table-column",{attrs:{field:"endaddress",title:t.$t("reportForm.endAddress"),width:"240",sortable:""}})],1)],1),e("div",[e("div",{staticStyle:{position:"absolute",left:"0px",bottom:"0px",top:"0px",width:"40%","padding-right":"10px","padding-top":"10px"}},[e("div",{staticClass:"full",staticStyle:{border:"1px solid #E8EAEC"}},[e("ReportMap",{ref:"reportMap"})],1)]),e("div",{staticStyle:{position:"absolute",right:"0px",top:"0px",width:"60%",bottom:"0px","padding-top":"10px"}},[e("div",{staticClass:"full",staticStyle:{border:"1px solid #E8EAEC"}},[e("TravelEchart",{ref:"echartsIns"})],1)])])])])],1)])},r=[],o=(i("99af"),i("14d9"),i("d3b7"),i("159b"),i("e561")),s=i("d462"),l=i("57c9"),n=i("5101"),d=i("80f4"),c=i("41da"),u=i("201d"),m=i("1c31"),p=i("7cf8"),h=i("c276"),b=i("6e52"),f=i("4c3c"),v=i("a05b"),g=i("0c87"),x={name:"ioReport",data:function(){return{loading:!1,exportLoading1:!1,activeName:"tabTotal",tableTitle:"",dateRange:[new Date,new Date],totalList:[],detailsList:[],ioindexs:[1,2,3,4],ioLists:[]}},watch:{dateRange:function(){this.loading||this.handleQuery()}},mixins:[f["a"],v["a"],g["a"]],components:{MultiChoiceVehicle:o["a"],SelectDate:s["a"],QuickTimeRange:l["a"],ReportMap:d["a"],TravelEchart:c["a"],LabelWrap:u["a"]},computed:{statisticsStyle:function(){return{zIndex:"tabTotal"==this.activeName?999:0}},detailsStyle:function(){return{zIndex:"details"==this.activeName?999:0}}},methods:{numberToFixed2:h["nb"],cellClickEvent:function(t){var e=this,i=t.row.data;Object(p["X"])(i).then((function(t){t.status;var i=t.records;i=i||[],e.$refs.reportMap.markersAndLineLayerToMap(i),e.$refs.echartsIns.updateChartsOption(i)})).catch((function(t){console.log(t)}))},onSelectDevice:function(t){this.deviceids=t},handleClickRow:function(t){if(t.records.length>0){this.activeName="details",this.detailsList=t.records,this.tableTitle=t.devicename+"-"+t.deviceid;var e=this.detailsList[0];this.$refs.xTable.setCurrentRow(e),this.cellClickEvent({row:e,rowIndex:0})}else this.$XModal.message({message:this.$t("tips.noData"),status:"error",zIndex:9999})},handleQuery:function(){var t=this,e=this.deviceids,i=this.dateRange;if(0!=e.length)if(0!=i.length){"details"==this.activeName&&(this.activeName="tabTotal",this.totalList=[],this.detailsList=[]);var a=n["a"].format(i[0],"yyyy-MM-dd"),r=n["a"].format(i[1],"yyyy-MM-dd"),o={startday:a,endday:r,offset:n["a"].getOffset(),deviceids:e,ioindexs:this.ioindexs,needaddress:1};this.loading=!0,Object(m["Q"])(o).then((function(e){var i=e.records,o=e.addressmap;t.loading=!1,t.queryDetailDateRange="".concat(a," ").concat(r);var s=[];t.addressmap=o,i&&(s=t.getAllIoTableData(i)),t.totalList=s}))}else this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999});else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},getAllIoTableData:function(t){var e=[],i=this.addressmap;return t.forEach((function(t,a){var r="",o=0,s=t.deviceid,l=b["a"].deviceInfos[t.deviceid],d=l.devicename,c=b["a"].getShowName(l.creater),u=l.groupname,m={index:a+1,deviceid:s,creater:c,groupname:u,opennumber:0,devicename:d,records:t.records,ioIndex:t.ioindex},p=0,f=0,v=0;t.records.forEach((function(t){t.devicename=d,t.creater=c,t.groupname=u,t.deviceid=s,t.begintimeStr=n["a"].longToLocalDateTimeStr(t.begintime),t.endtimeStr=n["a"].longToLocalDateTimeStr(t.endtime),t.sdistance=t.sdistance/1e3,t.edistance=t.edistance/1e3,t.duration=(t.endtime-t.begintime)/1e3/3600,1==t.iostate&&(v+=t.endtime-t.begintime,r=t.ioname,o++),t.totalotherfuel=t.totalotherfuel/100,t.totalrunningfuel=t.totalrunningfuel/100,p+=t.totalotherfuel,f+=t.totalrunningfuel,t.startaddress=Object(h["L"])(i,t.slat,t.slon),t.endaddress=Object(h["L"])(i,t.elat,t.elon),t.data={deviceid:t.deviceid,begintime:t.begintimeStr,endtime:t.endtimeStr,timezone:n["a"].getOffset()}})),m.ioName=r,m.openCount=o,m.totalotherfuel=p,m.totalrunningfuel=f,m.openDuration=v/1e3/3600,e.push(m)})),e},exportData:function(){if("tabTotal"==this.activeName){if(this.totalList.length){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.ioIndex"),this.$t("reportForm.ioName"),this.$t("reportForm.openCount"),this.$t("reportForm.openDuration"),this.$t("reportForm.oilConsumption"),this.$t("reportForm.totalnotrunningad")]];this.totalList.forEach((function(e,i){var a=[];a.push(i),a.push(e.devicename),a.push(e.deviceid),a.push(e.creater),a.push(e.groupname),a.push(e.ioIndex),a.push(e.ioName),a.push(e.openCount),a.push(Object(h["nb"])(e.openDuration)),a.push(Object(h["nb"])(e.totalrunningfuel)),a.push(Object(h["nb"])(e.totalotherfuel)),t.push(a)}));var e={title:this.$t("reportForm.ioReport"),data:t,dateRange:this.queryDetailDateRange};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}}else{var i=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.ioIndex"),this.$t("reportForm.ioName"),this.$t("reportForm.startTime"),this.$t("reportForm.endTime"),this.$t("reportForm.startDistance"),this.$t("reportForm.endDistance"),this.$t("reportForm.duration"),this.$t("reportForm.oilConsumption"),this.$t("reportForm.totalnotrunningad"),this.$t("reportForm.startLonLat"),this.$t("reportForm.endLonLat")]],a="";if(0==this.detailsList.length)return;this.detailsList.forEach((function(t,e){a=t.deviceid;var r=[];r.push(e),r.push(t.devicename),r.push(t.deviceid),r.push(t.ioindex),r.push(t.ioname),r.push(t.begintimeStr),r.push(t.endtimeStr),r.push(Object(h["nb"])(t.sdistance)),r.push(Object(h["nb"])(t.edistance)),r.push(Object(h["nb"])(t.duration)),r.push(Object(h["nb"])(t.totalrunningfuel)),r.push(Object(h["nb"])(t.totalotherfuel)),r.push(t.slon+","+t.slat),r.push(t.elon+","+t.elat),i.push(r)}));e={title:this.$t("reportForm.ioReport")+" - "+a,data:i};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}}},mounted:function(){this.deviceids=[];for(var t=[],e=1;e<=16;e++)t.push({label:"io_".concat(e),value:e});this.ioLists=t,this.queryDetailDateRange=null}},$=x,F=(i("5998"),i("2877")),w=Object(F["a"])($,a,r,!1,null,null,null),y=w.exports;e["default"]=y},"40fd":function(t,e,i){},5998:function(t,e,i){"use strict";i("40fd")}}]);