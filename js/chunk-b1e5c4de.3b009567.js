(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b1e5c4de"],{"10a7":function(t,e,n){"use strict";n("c646")},"271ae":function(t,e,n){},"2ddc":function(t,e,n){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice",style:t.warpStyle},[e("div",{staticClass:"multi-choice-input"},["daterange"==t.dateType?e("div",[e("el-date-picker",{attrs:{type:t.dateType,"picker-options":t.pickerOptions,"range-separator":"-",align:"center","unlink-panels":"",clearable:!1,"start-placeholder":t.$t("device.driverinitialdate"),"end-placeholder":t.$t("device.drivereffectivedate")},on:{change:t.onChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1):t._e(),"date"==t.dateType?e("div",[e("el-date-picker",{attrs:{type:"date","picker-options":t.datePickerOptions},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1):t._e(),"datetimerange"==t.dateType?e("div",{staticClass:"datetimerange"},[e("el-date-picker",{attrs:{type:t.dateType,"range-separator":"-","picker-options":t.pickerOptionsTime,align:"center","unlink-panels":"",clearable:!1,"start-placeholder":t.$t("device.driverinitialdate"),"end-placeholder":t.$t("device.drivereffectivedate"),"default-time":["00:00:00","23:59:59"]},on:{change:t.onChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1):t._e(),"month"==t.dateType?e("div",[e("el-date-picker",{attrs:{type:"month"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1):t._e()])])},i=[],o=(n("99af"),n("5101")),s=n("5867"),r={name:"SelectDate",props:{value:{type:Array|Date,default:function(){return[]}},dateType:{type:String,default:"daterange"},label:{type:String,default:function(){return this.$t("common.selectTime")}}},computed:{isDaterange:function(){return"daterange"==this.dateType},warpStyle:function(){var t=200;switch(this.dateType){case"date":t=120;break;case"daterange":t=230;break;case"datetimerange":t=310;break}return{width:"".concat(t,"px")}}},mixins:[s["a"]],data:function(){var t=864e5;return{dateRange:[],date:new Date,month:new Date,pickerOptions:{shortcuts:[{text:this.$t("reportForm.toDay"),onClick:function(t){var e=new Date;t.$emit("pick",[e,e])}},{text:this.$t("reportForm.yesterDay"),onClick:function(e){var n=new Date;n.setTime(n.getTime()-t),e.$emit("pick",[n,n])}},{text:this.$t("missing.theWeek"),onClick:function(e){var n=new Date,a=new Date,i=n.getDay();n.setTime(n.getTime()-t*(i-1)),a.setTime(n.getTime()+6*t),e.$emit("pick",[n,a])}},{text:this.$t("missing.lastWeek"),onClick:function(e){var n=new Date,a=new Date,i=n.getDay(),o=n.getTime()-t*(i-1);n.setTime(o-7*t),a.setTime(o-t),e.$emit("pick",[n,a])}},{text:this.$t("missing.thisMonth"),onClick:function(t){var e=new Date,n=e.getFullYear(),a=e.getMonth()+1,i=new Date("".concat(n,"-").concat(a,"-01")),o=new Date("".concat(n,"-").concat(a,"-01 00:00:00"));o.setMonth(o.getMonth()+1),o=new Date(o.getTime()-1e3),t.$emit("pick",[i,o])}},{text:this.$t("missing.lastMonth"),onClick:function(t){var e=new Date;e.setMonth(e.getMonth()-1);var n=e.getFullYear(),a=e.getMonth()+1,i=new Date(new Date(n,a,1)-1).getDate(),o=new Date("".concat(n,"-").concat(a,"-01")),s=new Date("".concat(n,"-").concat(a,"-").concat(i));t.$emit("pick",[o,s])}}]},pickerOptionsTime:{shortcuts:[{text:this.$t("reportForm.toDay"),onClick:function(t){var e=new Date(o["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),n=new Date(o["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59");t.$emit("pick",[e,n])}},{text:this.$t("reportForm.yesterDay"),onClick:function(e){var n=new Date;n.setTime(n.getTime()-t),e.$emit("pick",[new Date(o["a"].format(n,"yyyy-MM-dd")+" 00:00:00"),new Date(o["a"].format(n,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.theWeek"),onClick:function(e){var n=new Date,a=new Date,i=n.getDay();n.setTime(n.getTime()-t*(i-1)),a.setTime(n.getTime()+6*t),e.$emit("pick",[new Date(o["a"].format(n,"yyyy-MM-dd")+" 00:00:00"),new Date(o["a"].format(a,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.lastWeek"),onClick:function(e){var n=new Date,a=new Date,i=n.getDay(),s=n.getTime()-t*(i-1);n.setTime(s-7*t),a.setTime(s-t),e.$emit("pick",[new Date(o["a"].format(n,"yyyy-MM-dd")+" 00:00:00"),new Date(o["a"].format(a,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.thisMonth"),onClick:function(t){var e=new Date,n=e.getFullYear(),a=e.getMonth()+1,i=new Date("".concat(n,"-").concat(a,"-01")),s=new Date("".concat(n,"-").concat(a,"-01 00:00:00"));s.setMonth(s.getMonth()+1),s=new Date(s.getTime()-1e3),t.$emit("pick",[new Date(o["a"].format(i,"yyyy-MM-dd")+" 00:00:00"),new Date(o["a"].format(s,"yyyy-MM-dd")+" 23:59:59")])}},{text:this.$t("missing.lastMonth"),onClick:function(t){var e=new Date;e.setMonth(e.getMonth()-1);var n=e.getFullYear(),a=e.getMonth()+1,i=new Date(new Date(n,a,1)-1).getDate(),s=new Date("".concat(n,"-").concat(a,"-01")),r=new Date("".concat(n,"-").concat(a,"-").concat(i));t.$emit("pick",[new Date(o["a"].format(s,"yyyy-MM-dd")+" 00:00:00"),new Date(o["a"].format(r,"yyyy-MM-dd")+" 23:59:59")])}}]}}},watch:{dateRange:function(t){null==t?this.$emit("input",[]):this.$emit("input",t)},value:function(t){this.dateRange=t},date:function(t){this.$emit("input",t)},month:function(t){this.$emit("input",t)}},methods:{onChange:function(t){this.$emit("input",t)}},mounted:function(){"date"==this.dateType?this.date=this.value:"month"==this.dateType?this.month=this.value:this.dateRange=this.value}},c=r,l=(n("e716"),n("2877")),h=Object(l["a"])(c,a,i,!1,null,"5dbb8594",null);e["a"]=h.exports},"72ee":function(t,e,n){"use strict";n("bab3")},bab3:function(t,e,n){},c646:function(t,e,n){},c9b7:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("SelectDate",{attrs:{dateType:"month"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{type:"primary",loading:t.exportLoading1},on:{click:t.exportData}},[t._v(t._s(t.$t("common.export")))])],1)]),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"39px"}},[e("vxe-table",{attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.totalList},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index"),fixed:"left"}}),e("vxe-table-column",{attrs:{field:"devicename",title:t.$t("alarm.devName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"deviceid",title:t.$t("alarm.devNum"),sortable:""}}),e("vxe-table-column",{attrs:{field:"onlineDayAanTotalDay",title:t.$t("reportForm.onlineDayAanTotalDay"),sortable:""}}),e("vxe-table-column",{attrs:{field:"onlineRate",title:t.$t("reportForm.onlineRate"),sortable:""}}),e("vxe-table-column",{attrs:{title:t.$t("reportForm.onlineDate")},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleClickRow(n.row)}}},[t._v(t._s(t.$t("reportForm.details")))])]}}])})],1)],1),e("OnlineDate",{ref:"onlineDate",on:{queryOnlineMonth:t.queryOnlineMonth},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}})],1)])},i=[],o=(n("99af"),n("14d9"),n("4e82"),n("b680"),n("d3b7"),n("159b"),n("5101")),s=n("e561"),r=n("d462"),c=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:t.title,center:"",visible:t.value,width:"420px","append-to-body":"","close-on-click-modal":!1},on:{close:t.handleClose}},[e("div",{staticClass:"online-date"},[e("div",{staticClass:"online-date-header"},[e("div",{staticStyle:{width:"40%","line-height":"30px"}},[t._v(t._s(t.year)+t._s(t.$t("monitor.year"))+t._s(t.month)+t._s(t.$t("monitor.month")))]),e("div",{staticStyle:{width:"60%","text-align":"right"}},[e("el-button-group",[e("el-button",{attrs:{size:"mini"},on:{click:t.prveMonth}},[t._v(t._s(t.$t("monitor.prevMonth")))]),e("el-button",{attrs:{size:"mini"},on:{click:t.toDay}},[t._v(t._s(t.$t("el.datepicker.today")))]),e("el-button",{attrs:{size:"mini"},on:{click:t.nextMonth}},[t._v(t._s(t.$t("el.datepicker.nextMonth")))])],1)],1)]),e("div",{staticClass:"online-date-week"},t._l(t.weeks,(function(n,a){return e("div",{key:a},[t._v(t._s(n))])})),0),e("div",{staticClass:"online-date-dates"},t._l(t.datesArr,(function(n,a){return e("div",{key:a,class:{"active-day":n.isTheMonth,"no-current-month":!n.isTheMonth}},[e("div",{staticClass:"calendar-body-dates-date",domProps:{textContent:t._s(n.day)}}),e("div",{style:{color:n.color},domProps:{textContent:t._s(n.mileage)}})])})),0),e("div",{staticClass:"online-date-footer"},[e("div",[e("span",{domProps:{textContent:t._s(t.$t("reportForm.onlineDayAanTotalDay"))}}),t._v(" : "),e("span",{domProps:{textContent:t._s(t.onlineDayAanTotalDay)}})]),e("div",[e("span",{domProps:{textContent:t._s(t.$t("reportForm.onlineRate"))}}),t._v(" : "),e("span",{domProps:{textContent:t._s(t.onlineRate)}})])])])])},l=[],h=n("5530"),d=(n("3c65"),n("2f62")),u=n("6e52"),m={name:"OnlineDate",props:{value:{type:Boolean,default:!1}},data:function(){return{title:"",year:"",month:"",date:"",weeks:[this.$t("el.datepicker.weeks.mon"),this.$t("el.datepicker.weeks.tue"),this.$t("el.datepicker.weeks.wed"),this.$t("el.datepicker.weeks.thu"),this.$t("el.datepicker.weeks.fri"),this.$t("el.datepicker.weeks.sat"),this.$t("el.datepicker.weeks.sun")],datesArr:[],currentDate:o["a"].format(new Date,"yyyy-MM-dd"),onlineDayAanTotalDay:"",onlineRate:""}},watch:{value:function(t){}},computed:Object(h["a"])({},Object(d["b"])(["isZh"])),methods:{updateOnlineStatus:function(t,e,n,a,i){this.deviceid=t,this.dateStr=e,this.daysStatus=n,this.onlineDayAanTotalDay=a,this.onlineRate=i,this.setTheDate(e),this.title=this.$t("reportForm.onlineDate")+" - "+u["a"].getDeviceNameByDeviceId(t)},handleClose:function(){this.$emit("input",!1)},prveMonth:function(){var t=o["a"].reduceMonth(new Date(this.year,this.month-1,1),1);this.setTheDate(o["a"].format(t,"yyyy-MM-dd"));var e="".concat(this.year,"-").concat(this.month,"-").concat(this.date),n={deviceids:[this.deviceid],offset:o["a"].getOffset(),year:this.year,month:this.month,dateStr:e};this.$emit("queryOnlineMonth",n)},toDay:function(){var t=o["a"].format(new Date,"yyyy-MM-dd"),e=t.split("-")[0],n=t.split("-")[1],a={deviceids:[this.deviceid],offset:o["a"].getOffset(),year:e,month:n,dateStr:t};this.$emit("queryOnlineMonth",a)},nextMonth:function(){var t=o["a"].addMonth(new Date(this.year,this.month-1,1),1);if(!(this.currentDate<o["a"].format(t,"yyyy-MM-dd"))){this.setTheDate(o["a"].format(t,"yyyy-MM-dd"));var e="".concat(this.year,"-").concat(this.month,"-").concat(this.date),n={deviceids:[this.deviceid],offset:o["a"].getOffset(),year:this.year,month:this.month,dateStr:e};this.$emit("queryOnlineMonth",n)}},getTheMonthFirstDayWeek:function(){return new Date(this.year,this.month-1,1).getDay()},getTheMonthDays:function(){var t=12==this.month?this.year+1:this.year,e=12==this.month?1:this.month;return new Date(new Date(t,e,1)-1).getDate()},getPrevMonthLastDate:function(){return new Date(new Date(this.year,this.month-1,1)-1).getDate()},setTheDate:function(t){var e=t.split("-");this.year=e[0],this.month=e[1],this.date=e[2],this.datesArr=this.getDatesArr()},getDatesArr:function(){var t=[],e=this.getTheMonthFirstDayWeek(),n=this.getPrevMonthLastDate(),a=o["a"].format(new Date(new Date(this.year,this.month-2,1)),"yyyy-MM"),i=o["a"].format(new Date(new Date(this.year,this.month,1)),"yyyy-MM"),s=this.getTheMonthDays();while(e--)t.unshift({dateStr:a+"-"+(n>9?n:"0"+n),day:n--,isTheMonth:!1,isPrevMonth:!0,isNextMonth:!1,mileage:"-"});var r=1,c=this.month,l=this.daysStatus;while(s--){var h=l[r-1],d=!!h,u=this.year+"-"+c+"-"+(r<10?"0"+r:r),m="",y="";void 0===h?(m="-",y="#606266"):(m=d?this.$t("monitor.online"):this.$t("monitor.offline"),y=d?"#409EFF":"#e4393c"),t.push({day:r,isTheMonth:!0,mileage:m,dateStr:u,isOnline:d,color:y}),r++}var f=1;while(t.length<42){u=i+"-"+(f<10?"0"+f:f);t.push({day:f++,isTheMonth:!1,mileage:"-",dateStr:u,isNextMonth:!0,isPrevMonth:!1})}return t}},mounted:function(){}},y=m,f=(n("10a7"),n("2877")),p=Object(f["a"])(y,c,l,!1,null,"47bbb8f1",null),v=p.exports,D=n("1c31"),g=n("a05b"),w={name:"vehicleMonthOnline",data:function(){return{show:!1,loading:!1,exportLoading1:!1,month:new Date,totalList:[],dayList:[],sortConfig:{sortMethod:function(t){var e=t.data,n=t.sortList,a=n[0],i=a.property,o=a.order,s=[];return s="onlineDayAanTotalDay"==i||"onlineRate"==i?"desc"===o?e.sort((function(t,e){return e.onlineCount-t.onlineCount})):"asc"===o?e.sort((function(t,e){return t.onlineCount-e.onlineCount})):e.sort():"desc"===o?e.sort((function(t,e){var n=e[i]+"";return n.localeCompare(t[i])})):"asc"===o?e.sort((function(t,e){var n=t[i]+"";return n.localeCompare(e[i])})):e.sort(),s}}}},mixins:[g["a"]],components:{MultiChoiceVehicle:s["a"],SelectDate:r["a"],OnlineDate:v},watch:{month:function(t){this.dayList=this.getDayList(),this.loading||this.handleQuery()}},methods:{onSelectDevice:function(t){this.deviceids=t},handleClickRow:function(t){this.$refs.onlineDate.updateOnlineStatus(t.deviceid,t.yearMonth,t.daysstatus,t.onlineDayAanTotalDay,t.onlineRate),this.show=!0},queryOnlineMonth:function(t){var e=this;Object(D["J"])(t).then((function(n){var a=n.records;if(a&&a.length>0){var i=a[0].deviceid,o=a[0].daysstatus,s=0;o.forEach((function(t){1==t&&s++}));var r=s+"/"+o.length,c=(s/o.length*100).toFixed(2)+"%";e.$refs.onlineDate.updateOnlineStatus(i,t.dateStr,o,r,c)}}))},handleQuery:function(){var t=this,e=this.deviceids;if(0!=e.length){var n={deviceids:e,offset:o["a"].getOffset(),year:this.month.getFullYear(),month:this.month.getMonth()+1};this.queryDetailDateRange="".concat(n.year,"-").concat(n.month),this.loading=!0,Object(D["J"])(n).then((function(e){var n=e.records;t.loading=!1;var a=[];n&&(a=t.getTableData(n,t.month.getFullYear()+"-"+(t.month.getMonth()+1<10?"0"+(t.month.getMonth()+1):t.month.getMonth()+1)+"-01")),t.totalList=a}))}else this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999})},getTableData:function(t,e){var n=[];return t.forEach((function(t){var a=t.deviceid,i=u["a"].deviceInfos[a].devicename,o=t.daysstatus,s={deviceid:a,devicename:i,daysstatus:o},r=0;o.forEach((function(t){1==t&&r++})),s.onlineDayAanTotalDay=r+"/"+o.length;var c=r/o.length*100;s["onlineRate"]=c.toFixed(2)+"%",s.yearMonth=e,s.onlineCount=r,n.push(s)})),n},getTheMonthDays:function(t){var e=t.getFullYear(),n=t.getMonth()+1;return new Date(new Date(e,n,1)-1).getDate()},getDayList:function(){for(var t=[],e=this.getTheMonthDays(this.month),n=1;n<=e;n++)t.push({label:String(n),value:"day".concat(n)});return t},exportData:function(){if(0!=this.totalList.length){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.onlineDayAanTotalDay"),this.$t("reportForm.onlineRate")]];this.totalList.forEach((function(e,n){var a=[];a.push(n+1),a.push(e.devicename),a.push(e.deviceid),a.push(e.onlineDayAanTotalDay),a.push(e.onlineRate),t.push(a)}));var e={title:this.$t("reportForm.vehicleMonthOnline"),data:t,dateRange:this.queryDetailDateRange};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}}},mounted:function(){this.deviceids=[],this.dayList=this.getDayList(),this.queryDetailDateRange=null}},M=w,k=(n("72ee"),Object(f["a"])(M,a,i,!1,null,null,null)),$=k.exports;e["default"]=$},d462:function(t,e,n){"use strict";var a=n("2ddc");e["a"]=a["a"]},e561:function(t,e,n){"use strict";var a=n("ea22");e["a"]=a["a"]},e716:function(t,e,n){"use strict";n("271ae")}}]);