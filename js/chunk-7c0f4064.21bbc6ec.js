(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c0f4064"],{"449c":function(e,t,s){"use strict";s.r(t);var r=s("ade3"),a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"create-user full"},[t("div",{staticClass:"create-user-left"},[t("div",{staticClass:"create-user-inner full"},[t("div",{staticClass:"create-user-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("bgManage.createUserTitle1"))}}),t("span",{domProps:{textContent:e._s(e.$t("bgManage.createUserDesc1"))}}),t("el-tooltip",{attrs:{placement:"right",effect:"light"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("ul",{staticStyle:{padding:"0px 0px 0px 20px",margin:"0px"}},[t("li",{staticStyle:{padding:"0px","list-style-type":"disc"},domProps:{textContent:e._s(e.$t("bgManage.createUserTip1"))}}),t("li",{staticStyle:{padding:"4px 0px 0px 0px","list-style-type":"disc"},domProps:{textContent:e._s(e.$t("bgManage.createUserTip2"))}})])]),t("span",{staticStyle:{padding:"0 10px",position:"relative",top:"2px"}},[t("i",{staticClass:"el-icon-warning-outline new-add-tips-icon",staticStyle:{"font-size":"16px",color:"#ECC849"}})])])],1),t("div",{staticClass:"create-user-inner-content"},[t("div",{staticClass:"create-user-inner-content-tab"},[t("div",{class:["user"==e.activeTab?"tab-ative":""],on:{click:function(t){e.activeTab="user"}}},[e._v(e._s(e.$t("bgManage.createSubUser")))]),t("div",{class:["group"==e.activeTab?"tab-ative":""],on:{click:function(t){e.activeTab="group"}}},[e._v(e._s(e.$t("monitor.createGroup")))])]),t("div",{staticClass:"create-user-form"},[t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("DropdownZtreeUser",{ref:"ztreeUser",attrs:{showLabel:"",label:e.$t("bgManage.upperUser")},model:{value:e.creater,callback:function(t){e.creater=t},expression:"creater"}})],1)],1),"user"==e.activeTab?t("div",[t("el-row",{staticClass:"margin_b12"},[t("el-col",{staticClass:"red-star",attrs:{span:1}},[e._v("*")]),t("el-col",{attrs:{span:22}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.subUser")}},[t("el-input",{attrs:Object(r["a"])(Object(r["a"])({maxlength:"32",disabled:e.disabled},"maxlength",32),"placeholder",e.$t("common.maxWords32")),on:{focus:e.onFocusSubUsername,blur:function(t){e.showStatus=!1}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e.showStatus?t("div",{staticClass:"username-tips"},[t("el-alert",{attrs:{size:"mini",title:e.userTip,type:"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.accountLevel")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled},model:{value:e.userLevel,callback:function(t){e.userLevel=t},expression:"userLevel"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.initPassword")}},[t("el-input",{attrs:{disabled:e.disabled,placeholder:e.$t("login.inputPassword")},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{staticStyle:{height:"34px",background:"#1678ff","border-radius":"5px"},attrs:{type:"primary",loading:e.userLoading,size:"medium",disabled:e.disabled},on:{click:e.handleAddUser}},[e._v(e._s(e.$t("common.determine")))])],1)])],1)],1):e._e(),"group"==e.activeTab?t("div",[t("el-row",{staticClass:"margin_b12"},[t("el-col",{staticClass:"red-star",attrs:{span:1}},[e._v("*")]),t("el-col",{attrs:{span:22}},[t("LabelWrap",{attrs:{label:e.$t("reportForm.groupName")}},[t("el-input",{attrs:{maxlength:32,placeholder:e.$t("common.maxWords32")},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{staticStyle:{height:"34px",background:"#1678ff"},attrs:{type:"primary",loading:e.groupLoading,size:"medium"},on:{click:e.handleAddGroup}},[e._v(e._s(e.$t("common.determine")))])],1)])],1)],1):e._e()],1)])])]),t("div",{staticClass:"create-user-right"},[t("div",{staticClass:"create-user-inner full"},[t("div",{staticClass:"create-user-inner-title"},[t("i",{staticClass:"circle"}),t("b",{staticStyle:{padding:"0px 5px"},domProps:{textContent:e._s(e.$t("bgManage.previewList"))}}),t("b",{domProps:{textContent:e._s(e.$t("bgManage.account"))}}),e._v("("),t("img",{attrs:{src:e.userIcon}}),e._v(")"),t("b",{staticStyle:{"padding-left":"5px"},domProps:{textContent:e._s(e.$t("bgManage.group"))}}),e._v("("),t("img",{attrs:{src:e.groupIcon}}),e._v(") "),t("span",{staticClass:"refresh",on:{click:e.refreshZtree}},[t("i",{staticClass:"el-icon-refresh"})])]),t("div",{staticClass:"create-user-inner-content",staticStyle:{"padding-top":"0px"}},[t("div",{staticClass:"full",staticStyle:{overflow:"hidden"}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("ul",{staticClass:"ztree",attrs:{id:e.ztreeId}})])],1)])])])])},n=[],i=s("5530"),o=(s("99af"),s("14d9"),s("4e82"),s("b0c0"),s("d3b7"),s("498a"),s("159b"),s("6e52")),l=s("c7bc"),c=s("0139"),u=s("2f62"),d=s("e285"),p=s("c276"),g=s("6821"),h=s.n(g),m=s("0d33"),v=s("7fa8"),f={name:"createUser",data:function(){return{activeTab:"user",creater:"",username:"",password:"123456",groupname:"",userIcon:m,groupIcon:v,userLevel:"",userOptions:[],showStatus:!1,userLoading:!1,groupLoading:!1,userTip:""}},computed:Object(i["a"])(Object(i["a"])({},Object(u["b"])(["isZh","userName","userLevelList","isQueryInitData"])),{},{ztreeId:function(){return"ztreeEl_".concat(this._uid)},disabled:function(){return 0==this.userOptions.length}}),watch:{userName:function(e){this.creater=e},username:function(e){"user"==this.activeTab&&this.checkUsernameStatus(this,e.trim())},userOptions:function(e){0==e.length&&this.$XModal.message({message:this.$t("bgManage.ordinarySupervisorsCannotCreateSubAccounts"),status:"error",zIndex:9999})},creater:function(e){this.userLevelList;var t=o["a"].getUserByUserName(e);t&&(this.userOptions=this.getUserOptions(t.usertype),this.userOptions.length&&(this.userLevel=this.userOptions[0].value))},isQueryInitData:function(e){if(e){this.creater=this.userName;var t=o["a"].getUserByUserName(this.userName);t&&(this.userOptions=this.getUserOptions(t.usertype),this.userOptions.length&&(this.userLevel=this.userOptions[0].value)),this.initZtree()}}},components:{DropdownZtreeUser:l["a"],LabelWrap:c["a"]},methods:Object(i["a"])(Object(i["a"])({},Object(u["c"])(["setIsReloadRootuser","setReportTagList"])),{},{checkUsernameStatus:Object(p["e"])((function(e,t){Object(d["n"])(t).then((function(t){var s=t.status;0==s?e.showStatus=!1:1==s?(e.showStatus=!0,e.userTip=e.$t("tips.accountNameOccupied")):2==s?(e.showStatus=!0,e.userTip=e.$t("tips.insufficientLength")):3==s?(e.showStatus=!0,e.userTip=e.$t("tips.lengthTooLong")):e.showStatus=!1}))}),300),onFocusSubUsername:function(){this.showStatus=!1,this.checkUsernameStatus(this,this.username)},handleAddUser:function(){var e=this,t=this.creater.trim(),s=this.username.trim();if(""!=s)if(s.length>32)this.$XModal.message({message:this.$t("bgManage.accountNameTooLong"),status:"error",zIndex:9999});else{this.userLoading=!0;var r={creater:t,username:s,usertype:this.userLevel,password:h()(this.password),multilogin:1};Object(d["i"])(r).then((function(a){var n=a.status,i=a.cause;if(e.userLoading=!1,0==n){o["a"].NodeType_User,r.usertype;var l={showname:s,username:s,subusers:null,groups:null,usertype:r.usertype};o["a"].addUser(t,l),e.$refs.ztreeUser.refreshZtree(),e.ztreeIns.destroy(),e.initZtree();var c=e.getTreeNodeByUsername(e.ztreeIns.getNodes(),s);null!=c&&(e.ztreeIns.cancelSelectedNode(),e.ztreeIns.selectNode(c,!0)),e.setReportTagList([]),e.setIsReloadRootuser(!0),e.$XModal.message({message:e.$t("tips.addSucc"),status:"success",zIndex:9999})}else 1==n?e.$XModal.message({message:e.$t("tips.accountNameOccupied"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.addFail")+" "+i,status:"error",zIndex:9999})})).catch((function(t){e.userLoading=!1}))}},handleAddGroup:function(){var e=this,t=this.creater.trim(),s=this.username.trim();if(""!=s)if(s.length>32)this.$XModal.message({message:this.$t("bgManage.groupNameTooLong"),status:"error",zIndex:9999});else{this.groupLoading=!0;var r={groupname:s,creater:t};Object(d["e"])(r).then((function(s){var r=s.status,a=s.cause,n=s.groupid,i=s.groupname;if(e.groupLoading=!1,0==r){o["a"].NodeType_Group;var l={devices:[],groupid:n,groupname:i,remark:null};o["a"].addGroup(t,l),e.$refs.ztreeUser.refreshZtree(),e.ztreeIns.destroy(),e.initZtree();var c=e.getTreeNodeByGroupname(e.ztreeIns.getNodes(),n);null!=c&&(e.ztreeIns.cancelSelectedNode(),e.ztreeIns.selectNode(c,!0)),e.setReportTagList([]),e.setIsReloadRootuser(!0),e.$XModal.message({message:e.$t("tips.addSucc"),status:"success",zIndex:9999})}else 1==r?e.$XModal.message({message:e.$t("tips.addGroupSame"),status:"error",zIndex:9999}):2==r?e.$XModal.message({message:e.$t("tips.editDeviceFailTip3"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.addFail")+":"+a,status:"error",zIndex:9999})})).catch((function(t){e.groupLoading=!1}))}},refreshZtree:function(){this.ztreeIns.destroy(),this.initZtree()},getTreeNodeByUsername:function(e,t){var s=null;function r(e,t){for(var a in e){var n=e[a];"user"===n.nodeType&&n.username&&n.username==t?s=n:n.children&&n.children.length>0&&r(n.children,t)}}return r(e,t),s},getTreeNodeByGroupname:function(e,t){var s=null;function r(e,t){for(var a in e){var n=e[a];"group"===n.nodeType&&void 0!=n.groupid&&n.groupid==t?s=n:n.children&&n.children.length>0&&r(n.children,t)}}return r(e,t),s},initZtree:function(){var e=this.castUsersTreeToDevicesTree(o["a"].rootuser);this.ztreeIns=$.fn.zTree.init($("#".concat(this.ztreeId)),this.setting,e)},castUsersTreeToDevicesTree:function(e){var t={name:"",icon:m,username:"",open:!0,nodeType:o["a"].NodeType_User};if(null!=e){var s=e.username,r=e.subusers;e.showname;t.name=s,t.username=s;var a=this.getDeviceListGroups(e.groups,s);if(null!=s&&null!=r&&r.length>0){var n=this.doCastUsersTreeToDevicesTree(r);n&&n.length&&(t.children=n)}var i=a.concat(t.children?t.children:[]);i.length&&(t.children=i,Object(p["Fb"])(t.children));var l=0;if(t.children)for(var c=0;c<t.children.length;++c){var u=t.children[c];void 0!=u.totalCount?l+=u.totalCount:l++}t.totalCount=l,t.name+="("+l+")"}return[t]},doCastUsersTreeToDevicesTree:function(e){var t=[];if(null!=e&&e.length>0)for(var s=0;s<e.length;++s){var r=e[s],a=r.username,n=r.subusers,i=r.showname,l={name:i||a,icon:m,username:a,nodeType:o["a"].NodeType_User};if(null!=a&&null!=n&&n.length>0){var c=this.doCastUsersTreeToDevicesTree(n);c&&c.length&&(l.children=c)}var u=this.getDeviceListGroups(r.groups,a),d=u.concat(l.children?l.children:[]);d.length&&(l.children=d,Object(p["Fb"])(l.children));var g=0;if(l.children)for(var h=0;h<l.children.length;++h){var v=l.children[h];void 0!=v.totalCount?g+=v.totalCount:g++}l.totalCount=g,l.name+="("+g+")",t.push(l)}return t},getDeviceListGroups:function(e,t){var s=[];if(e){for(var r=this.$t("common.defaultGroup"),a=0;a<e.length;++a){var n=e[a],i=void 0===n.shared?0:n.shared,l=n.groupid>0,c=l?n.groupname:r,u={groupid:n.groupid,name:c+"("+n.devices.length+")",groupname:c,icon:v,id:t+"_"+n.groupid,nodeType:o["a"].NodeType_Group,totalCount:n.devices.length};l?1!==i&&s.push(u):n.devices.length>0&&s.push(u)}s.sort((function(e,t){return e.groupid-t.groupid}))}return s},getUserOptions:function(e){var t=[];return this.userLevelList.forEach((function(s){var r=s.name,a=s.type;a>e&&a<=11&&t.push({label:r,value:a})})),t},init:function(){var e=this;this.$nextTick((function(){e.creater=e.userName;var t=o["a"].getUserByUserName(e.userName);t&&(e.userOptions=e.getUserOptions(t.usertype),e.userOptions.length&&(e.userLevel=e.userOptions[0].value)),e.initZtree()}))}}),created:function(){this.setting={}},destroyed:function(){this.ztreeIns.destroy(),this.ztreeIns=null},mounted:function(){this.isQueryInitData&&this.init()}},b=f,y=(s("ce1e"),s("2877")),T=Object(y["a"])(b,a,n,!1,null,null,null),x=T.exports;t["default"]=x},"5e7b":function(e,t,s){},ce1e:function(e,t,s){"use strict";s("5e7b")}}]);